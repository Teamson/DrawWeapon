!function(){"use strict";class e{static httpRequest(e,t,a="get",i){var n=new Laya.HttpRequest;n.http.timeout=5e3,n.once(Laya.Event.COMPLETE,this,i),n.once(Laya.Event.ERROR,this,this.httpRequest,[e,t,a,i]),"get"==a?n.send(e+"?"+t,"",a,"text"):"post"==a&&n.send(e,JSON.stringify(t),a,"text")}static shuffleArr(e){let t=e.length;for(;t;){let a=Math.floor(Math.random()*t--);[e[a],e[t]]=[e[t],e[a]]}return e}static fixNodeY(e){e.y=e.y*Laya.stage.displayHeight/Laya.stage.designHeight}static visibleDelay(e,t=1500){e.visible=!1,Laya.timer.once(t,this,()=>{e.visible=!0})}static tMove(e,t,a,i,n){Laya.Tween.to(e,{x:t,y:a},i,null,new Laya.Handler(this,()=>{n&&n()}))}}var t,a;!function(e){e.SCENE_FRIENDGAME="JJExport/FriendGameUI.scene",e.SCENE_SCROLLUI="JJExport/ScrollUI.scene",e.SCENE_RECOMMENDUI="JJExport/RecommendUI.scene",e.SCENE_FULLGAMEUI="JJExport/FullGameUI.scene",e.SCENE_FINISHGAMEUI="JJExport/FinishGameUI.scene",e.SCENE_DRAWUI="JJExport/DrawUI.scene",e.SCENE_NEWGAMEUI="JJExport/NewGameUI.scene",e.SCENE_PROGRAMUI="JJExport/ProgramUI.scene"}(t||(t={}));class i{constructor(){this.dataConfig={allow_share:!0,front_allow_return:!0,front_banner_number:8,front_banner_second:800,front_button_second:300,front_ckin_banner_move:700,front_ckin_banner_second:500,front_direct_draw:!0,front_extra_share:!1,front_home_screen_level:10,front_home_screen_number:5,front_lucky_screen_chance:50,front_lucky_screen_level:20,front_lucky_screen_number:5,front_pass_gate:10,front_proceed_game:1e3,front_proceed_history:1,front_share_config:{image:"https://oss.99huyu.cn/wxhuyu/a1f98703efb3f3bfe2b9a4d5a250f926.png",title:"根据实际年纪看看你该在啥水平..."},front_share_number:4,is_allow_area:1},this.navDataArr=[],this.JJConfigUrl="https://jiujiu.99huyu.cn/m/weapon/config.json",this.isFinished=!1}static get instance(){return this._instance||(this._instance=new i),this._instance}canShowFullScreen(e){return e>=this.dataConfig.front_auto_remen_level}initJJ(t,a="1.0.0",i){e.httpRequest(this.JJConfigUrl,"version="+a+"&code="+t,"get",e=>{e=JSON.parse(e),console.log("JJ config.json:",e),this.dataConfig=e.data.config,this.navDataArr=e.data.mores.remen_game,this.isFinished=!0,i&&i(e.data.userinfo.openid)})}openScene(e,t=!1,a,i){Laya.Scene.open(e,t,a,Laya.Handler.create(this,e=>{i&&i.addChild(e)}))}closeScene(e){Laya.Scene.close(e)}NavigateApp(e,a,i,n){if(Laya.Browser.onWeiXin){switch(Laya.Browser.window.wx.aldSendEvent("导出-总点击数"),n){case t.SCENE_DRAWUI:Laya.Browser.window.wx.aldSendEvent("抽屉页面-总点击数");break;case t.SCENE_FINISHGAMEUI:break;case t.SCENE_FRIENDGAME:Laya.Browser.window.wx.aldSendEvent("好友都在玩的爆款游戏弹-总点击数");break;case t.SCENE_FULLGAMEUI:Laya.Browser.window.wx.aldSendEvent("全屏幕导出页-总点击数");break;case t.SCENE_RECOMMENDUI:Laya.Browser.window.wx.aldSendEvent("热门推荐全屏幕导出页-总点击数");break;case t.SCENE_SCROLLUI:break;case t.SCENE_PROGRAMUI:Laya.Browser.window.wx.aldSendEvent("游戏历史列表导出页-总点击数")}Laya.Browser.window.wx.navigateToMiniProgram({appId:this.navDataArr[e].appid,path:this.navDataArr[e].path,success:a=>{switch(i&&i(),Laya.Browser.window.wx.aldSendEvent("导出成功-总用户数"),Laya.Browser.window.wx.aldSendEvent("导出成功-"+this.navDataArr[e].title),console.log("导出成功-"+this.navDataArr[e].title),n){case t.SCENE_DRAWUI:Laya.Browser.window.wx.aldSendEvent("抽屉页面-总成功跳转数");break;case t.SCENE_FINISHGAMEUI:break;case t.SCENE_FRIENDGAME:Laya.Browser.window.wx.aldSendEvent("好友都在玩的爆款游戏弹-总成功跳转数");break;case t.SCENE_FULLGAMEUI:Laya.Browser.window.wx.aldSendEvent("全屏幕导出页-总成功跳转数");break;case t.SCENE_RECOMMENDUI:Laya.Browser.window.wx.aldSendEvent("热门推荐全屏幕导出页-总成功跳转数");break;case t.SCENE_SCROLLUI:break;case t.SCENE_PROGRAMUI:Laya.Browser.window.wx.aldSendEvent("游戏历史列表导出页-总成功跳转数")}},fail:e=>{a&&a()}})}}getTitle(e,t=!0){return t&&this.navDataArr[e].subtitle&&""!=this.navDataArr[e].subtitle?this.navDataArr[e].subtitle:this.navDataArr[e].title}}class n{static calcDistance(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}static getDirectionAToB(e,t,a=!0){let i=e.transform.position.clone(),n=t.transform.position.clone(),s=new Laya.Vector3(0,0,0);return Laya.Vector3.subtract(n,i,s),a&&Laya.Vector3.normalize(s,s),s}static fixPosY(e,t=1334){return e*Laya.stage.displayHeight/t}static findNodeByName(e,t){let a=null,i=e=>{for(let n=0;n<e.numChildren;n++){if(e.getChildAt(n).name==t)return void(a=e.getChildAt(n));i(e.getChildAt(n))}};return i(e),a}static TmoveTo(e,t,a,i,n){let s=new Laya.Tween;var r=e.transform.position;s.to(e.transform.position,{x:a.x,y:a.y,z:a.z,update:new Laya.Handler(this,()=>{e.transform.position=r})},t,n||Laya.Ease.cubicOut,Laya.Handler.create(this,()=>{i&&i()}))}static RotateTo(e,t,a,i){var n=e.transform.localRotationEuler;Laya.Tween.to(e.transform.localRotationEuler,{x:a.x,y:a.y,z:a.z,update:new Laya.Handler(this,function(){e&&(e.transform.localRotationEuler=n)})},t,Laya.Ease.cubicOut,Laya.Handler.create(this,function(){i&&i()}))}static tMove2D(e,t,a,i,n){Laya.Tween.to(e,{x:t,y:a},i,null,new Laya.Handler(this,()=>{n&&n()}))}static updateNumber(e,t,a,i=!0,n,s){let r=e*t,o=Math.floor((r-e)/60);o=o<=0?1:o;let l=()=>{n?((e+=o)>=r&&(e=r,s&&s(),Laya.timer.clear(this,l)),i?a.text=e.toString():a.value=e.toString()):((r-=o)<=e&&(r=e,s&&s(),Laya.timer.clear(this,l)),i?a.text=r.toString():a.value=r.toString())};Laya.timer.frameLoop(1,this,l)}static loadJson(e,t){Laya.loader.load(e,Laya.Handler.create(this,t),null,Laya.Loader.JSON)}static objectShake(e,t=1,a=.7){var i=t,n=1,s=e.transform.localPosition.clone();Laya.timer.frameLoop(1,this,function updateShake(){if(i>0){var t=new Laya.Vector3;Laya.Vector3.scale((r=Math.random()>.5?Math.random():-Math.random(),o=Math.random()>.5?Math.random():-Math.random(),new Laya.Vector3(r,o,0)),a,t),Laya.Vector3.add(s,t,t),e.transform.localPosition=t,i-=.02*n}else i=0,e.transform.localPosition=s,Laya.timer.clear(this,updateShake);var r,o})}static getRandomItemInArr(e){return e[Math.floor(Math.random()*e.length)]}static shuffleArr(e){let t=e.length;for(;t;){let a=Math.floor(Math.random()*t--);[e[a],e[t]]=[e[t],e[a]]}return e}static GetRandom(e,t,a=!0){let i=t-e,n=Math.random()*i;return n+=e,a?Math.floor(n):n}static coinCollectAnim(e,t,a,i=10,n){let s=i;for(var r=0;r<i;r++){let i=Laya.Pool.getItemByClass("coin",Laya.Image);i.skin="mainUI/sy-jb.png",i.x=e.x,i.y=e.y,a.addChild(i);let r=300+100*Math.random()-50;Laya.Tween.to(i,{x:i.x+250*Math.random()-125,y:i.y+250*Math.random()-125},r),Laya.timer.once(r+50,this,function(){Laya.Tween.to(i,{x:t.x,y:t.y},400,null,new Laya.Handler(this,function(){a.removeChild(i),Laya.Pool.recover("coin",i),0==--s&&n&&n()}))})}}static scaleLoop(e,t,a){Laya.Tween.to(e,{scaleX:t,scaleY:t},a,null,new Laya.Handler(this,()=>{Laya.Tween.to(e,{scaleX:1,scaleY:1},a,null,new Laya.Handler(this,()=>{this.scaleLoop(e,t,a)}))}))}static rotateLoop(e,t,a){Laya.Tween.to(e,{rotation:t},a,null,new Laya.Handler(this,()=>{Laya.Tween.to(e,{rotation:-t},2*a,null,new Laya.Handler(this,()=>{Laya.Tween.to(e,{rotation:0},a,null,new Laya.Handler(this,()=>{this.rotateLoop(e,t,a)}))}))}))}static visibleDelay(e,t){e.visible=!1,Laya.timer.once(t,this,()=>{e.visible=!0})}}class s{constructor(){this.grade=1,this.gradeIndex=0,this.power=10,this.playerCountLv=1,this.playerPowerLv=1,this.playerOfflineLv=1,this.coin=0,this.playerId=0,this.playerArr=[],this.unlockSkinCount=0,this.exitTime=0}}class r{static getPlayerData(){if(localStorage.getItem("playerData"))null==this._playerData&&(this._playerData=JSON.parse(localStorage.getItem("playerData")));else{this._playerData=new s;for(let e=0;e<27;e++)0==e?this._playerData.playerArr.push(0):this._playerData.playerArr.push(-1);localStorage.setItem("playerData",JSON.stringify(this._playerData))}return this._playerData}static setPlayerData(){localStorage.setItem("playerData",JSON.stringify(this._playerData))}static getPlayerYet(){let e=[];for(let t=0;t<this._playerData.playerArr.length;t++)this._playerData.playerArr[t]<0&&e.push(t);return e}static getCoinSkins(){let e=[].concat(this.skinArr1),t=[];for(let a=0;a<e.length;a++)this._playerData.playerArr[a]<0&&t.push(e[a]);return t}static getVideoSkins(){let e=[].concat(this.skinArr2),t=[];for(let a=0;a<e.length;a++)this._playerData.playerArr[a+9]<0&&t.push(e[a]);return t}static getFreeSkins(){let e=[].concat(this.skinArr1,this.skinArr2,this.skinArr3);e=n.shuffleArr(e);let t=[];for(let a=0;a<e.length;a++){let i=this.getPlayerArrIndexByValue(e[a]);if(this._playerData.playerArr[i]<0&&(t.push(e[a]),t.length>=4))break}return t}static getBoxSkins(){let e=[].concat(this.skinArr3),t=[];for(let a=0;a<e.length;a++)this._playerData.playerArr[a+18]<0&&t.push(e[a]);return t}static changeCoin(e){this._playerData.coin+=e,this.setPlayerData()}static getPlayerSkin(e,t){this._playerData.playerArr[e]=t,this._playerData.playerId=t,this.setPlayerData()}static getPlayerCountLv(){return this._playerData.playerCountLv}static upgradePlayerCountLv(){this._playerData.playerCountLv>=5||(this._playerData.playerCountLv+=1,this.setPlayerData())}static getPlayerCount(){return this._playerData.playerCountLv}static getCountLvMax(){return this._playerData.playerCountLv>=5}static getPlayerPowerLv(){return this._playerData.playerPowerLv}static upgradePlayerPowerLv(){this._playerData.playerPowerLv>=35||(this._playerData.playerPowerLv+=1,this.setPlayerData())}static getPlayerPowerData(){let e={hp:125,atk:20};return e.hp=125+4*(this._playerData.playerPowerLv-1),e.atk=20+2*(this._playerData.playerPowerLv-1),e}static getPowerLvMax(){return this._playerData.playerPowerLv>=35}static getPlayerOfflineLv(){return this._playerData.playerOfflineLv}static upgradePlayerOfflineLv(){this._playerData.playerOfflineLv>=56||(this._playerData.playerOfflineLv+=1,this.setPlayerData())}static getPlayerOffline(e){return Math.floor(e*(1+.05*(this._playerData.playerOfflineLv-1)))}static getOfflineLvMax(){return this._playerData.playerOfflineLv>=56}static getNpcData(){let e={hp:100,atk:10},t=Math.floor((this._playerData.grade-1)/5)+1;return e.hp=100+10*(t-1),e.atk=10+5*(t-1),e.hp>240&&(e.hp=240),e.atk>90&&(e.atk=90),e}static getUpgradePlayerCountLvCost(){let e=100;return e=100+500*(this.getPlayerCountLv()-1)}static getUpgradePlayerPowerLvCost(){let e=50;return e=50+50*(this.getPlayerPowerLv()-1)}static getUpgradeOfflineLvCost(){let e=50;return e=50+50*(this.getPlayerOfflineLv()-1)}static getUnlockSkinCost(){return 100+100*this._playerData.unlockSkinCount}static getHeroSkinDir(e){return"heroSkins/Hero_"+(e+1)+".png"}static setExitTime(){this._playerData.exitTime=(new Date).getTime(),this.setPlayerData()}static getPlayerArrIndexByValue(e){for(let t=0;t<this.skinArr1.length;t++)if(-1!=this.skinArr1.indexOf(e))return this.skinArr1.indexOf(e);for(let t=0;t<this.skinArr2.length;t++)if(-1!=this.skinArr2.indexOf(e))return this.skinArr2.indexOf(e)+9;for(let t=0;t<this.skinArr3.length;t++)if(-1!=this.skinArr3.indexOf(e))return this.skinArr3.indexOf(e)+18;return-1}}r._playerData=null,r.tempSkinId=-1,r.aiConfig=null,r.posConfig=null,r.freeSkinId=-1,r.skinArr1=[0,1,2,8,9],r.skinArr2=[3,4],r.skinArr3=[5,6,7],r.skinArr4=[8,9];class o{static get instance(){return this._instance||(this._instance=new o),this._instance}initLoading(e){var t=[{url:"res/sounds/bgm.mp3",type:Laya.Loader.SOUND},{url:"res/sounds/castleHit1.mp3",type:Laya.Loader.SOUND},{url:"res/sounds/castleHit2.mp3",type:Laya.Loader.SOUND},{url:"res/sounds/castleHit3.mp3",type:Laya.Loader.SOUND},{url:"res/sounds/die1.mp3",type:Laya.Loader.SOUND},{url:"res/sounds/die2.mp3",type:Laya.Loader.SOUND},{url:"res/sounds/getCoin.mp3",type:Laya.Loader.SOUND},{url:"res/sounds/weaponHit1.mp3",type:Laya.Loader.SOUND},{url:"res/sounds/weaponHit2.mp3",type:Laya.Loader.SOUND},{url:"res/sounds/weaponHit3.mp3",type:Laya.Loader.SOUND},{url:"res/sounds/weaponHit4.mp3",type:Laya.Loader.SOUND},{url:"res/sounds/weaponReady.mp3",type:Laya.Loader.SOUND}];Laya.loader.load(t,Laya.Handler.create(this,e)),Laya.SoundManager.useAudioMusic=!0,Laya.SoundManager.setMusicVolume(1)}playMusic(e,t=0,a){Laya.SoundManager.playMusic("res/sounds/"+e,t,new Laya.Handler(this,a))}stopMusic(){Laya.SoundManager.stopMusic()}playSoundEffect(e,t=1,a){Laya.SoundManager.playSound("res/sounds/"+e,t,new Laya.Handler(this,a))}}class l{constructor(){this.path="",this.picCount=3,this.preT=0,this.shareTips=["请分享到活跃的群！","请分享到不同群！","请分享给好友！","请分享给20人以上的群！"]}static get instance(){return this._instance||(this._instance=new l),this._instance}initShare(){if(Laya.Browser.onWeiXin){Laya.Browser.window.wx.showShareMenu({withShareTicket:!0});let e=i.instance.dataConfig.front_share_config.image,t=i.instance.dataConfig.front_share_config.title;Laya.Browser.window.wx.onShareAppMessage(function(a){return{title:t,imageUrl:e}}),Laya.Browser.window.wx.onShow(e=>{if(o.instance.playMusic("bgm.mp3"),c.shareCallback){((new Date).getTime()-c.shareTime)/1e3>=3&&!c.firstShare?(c.shareCallback(),c.front_share_number--,Laya.Browser.window.wx.showToast({title:"分享成功",icon:"none",duration:2e3}),c.shareCallback=null):(c.firstShare=!1,Laya.Browser.window.wx.showModal({title:"提示",content:this.shareTips[Math.floor(Math.random()*this.shareTips.length)],confirmText:"重新分享",success(e){e.confirm?(console.log("用户点击确定"),l.instance.shareGame(c.shareCallback)):e.cancel&&console.log("用户点击取消")}}))}})}}shareGame(e){if(c.front_share_number<=0)return void h.instance.showVideo(e);if(c.shareCallback=e,!Laya.Browser.onWeiXin)return void e();c.shareTime=(new Date).getTime();let t=i.instance.dataConfig.front_share_config.image,a=i.instance.dataConfig.front_share_config.title;Laya.Browser.window.wx.shareAppMessage({title:a,imageUrl:t})}}class h{constructor(){this.bannerUnitId=["adunit-441b22cb32c3f6b7","adunit-ca1d1fda0b8c4a03"],this.videoUnitId="adunit-c35dcf999bc0fcf3",this.bannerAd=null,this.videoAd=null,this.videoCallback=null,this.curBannerId=0,this.showBannerCount=0,this.videoIsError=!1,this.videoLoaded=!1}static get instance(){return this._instance||(this._instance=new h),this._instance}initAd(){Laya.Browser.onWeiXin&&(this.initBanner(),this.initVideo())}initBanner(){let e=!1;Laya.Browser.onWeiXin&&Laya.Browser.window.wx.getSystemInfo({success:t=>{-1!=t.model.search("iPhone X")&&(e=!0)}});let t=Laya.Browser.window.wx.getSystemInfoSync();this.bannerAd=Laya.Browser.window.wx.createBannerAd({adUnitId:this.bannerUnitId[this.curBannerId],style:{left:0,top:0,width:0,height:300}}),this.bannerAd.onResize(a=>{this.bannerAd.style.top=e?t.windowHeight-this.bannerAd.style.realHeight-10:t.windowHeight-this.bannerAd.style.realHeight,this.bannerAd.style.left=t.windowWidth/2-this.bannerAd.style.realWidth/2}),this.bannerAd.onError(e=>{console.log("banner error:",JSON.stringify(e))})}hideBanner(e=!0){Laya.Browser.onWeiXin&&(this.bannerAd.hide(),null!=i.instance.dataConfig&&this.showBannerCount>=parseInt(i.instance.dataConfig.front_banner_number)&&e&&(this.showBannerCount=0,this.curBannerId++,this.curBannerId>=this.bannerUnitId.length&&(this.curBannerId=0),console.log("destroy banner"),this.bannerAd.destroy(),this.bannerAd=null,this.initBanner()))}showBanner(){Laya.Browser.onWeiXin&&(this.showBannerCount++,this.bannerAd.show())}destroyBanner(){Laya.Browser.onWeiXin&&this.bannerAd&&(this.bannerAd.destroy(),this.bannerAd=null)}initVideo(){Laya.Browser.onWeiXin&&(this.videoAd||(this.videoAd=Laya.Browser.window.wx.createRewardedVideoAd({adUnitId:this.videoUnitId})),this.loadVideo(),this.videoAd.onLoad(()=>{console.log("激励视频加载成功"),this.videoLoaded=!0}),this.videoAd.onError(e=>{console.log("video Error:",JSON.stringify(e)),this.videoIsError=!0}))}loadVideo(){Laya.Browser.onWeiXin&&null!=this.videoAd&&(this.videoIsError=!1,this.videoAd.load())}showVideo(e){if(this.videoCallback=e,Laya.Browser.onWeiXin)return this.videoIsError?(l.instance.shareGame(e),void this.loadVideo()):void(0!=this.videoLoaded?(this.videoAd&&this.videoAd.offClose(),Laya.SoundManager.muted=!0,this.videoAd.onClose(e=>{e&&e.isEnded||void 0===e?(console.log("正常播放结束，可以下发游戏奖励"),this.videoCallback()):console.log("播放中途退出，不下发游戏奖励"),Laya.SoundManager.muted=!1,this.videoLoaded=!1,this.loadVideo()}),this.videoAd.show()):c.OpenAlert("视频正在加载中！"));this.videoCallback()}}class c{static LoginWx(e){if(!Laya.Browser.onWeiXin)return;let t=Laya.Browser.window.wx.getLaunchOptionsSync();Laya.Browser.window.wx.login({success(a){a.code&&(console.log("res.code:",a.code),e&&e(a.code,t.query))}})}static checkScope(e){Laya.Browser.onWeiXin&&Laya.Browser.window.wx.getSetting({success:t=>{t.authSetting["scope.userInfo"]?console.log("已经授权"):(console.log("没有授权"),this.createScope(e))}})}static createScope(e){this.scopeBtn=Laya.Browser.window.wx.createUserInfoButton({type:"text",text:"",style:{left:e.x,top:e.y,width:e.width,height:e.height,lineHeight:40,backgroundColor:"#ffffff",color:"#ffffff",textAlign:"center",fontSize:16,borderRadius:0}}),this.scopeBtn.onTap(e=>{"getUserInfo:ok"==e.errMsg?(this.scopeBtn.destroy(),this.scopeBtn=null):"getUserInfo:fail auth deny"==e.errMsg&&(this.scopeBtn.destroy(),this.scopeBtn=null)})}static GetLaunchParam(e){Laya.Browser.onWeiXin&&(this.OnShowFun=e,e(this.GetLaunchPassVar()),Laya.Browser.window.wx.onShow(e=>{null!=this.OnShowFun&&this.OnShowFun(e),console.log("wx on show")}))}static GetLaunchPassVar(){return Laya.Browser.onWeiXin?Laya.Browser.window.wx.getLaunchOptionsSync():null}static WxOnHide(e){Laya.Browser.onWeiXin&&Laya.Browser.window.wx.onHide(e)}static httpRequest(e,t,a="get",i){var n=new Laya.HttpRequest;n.http.timeout=5e3,n.once(Laya.Event.COMPLETE,this,i),n.once(Laya.Event.ERROR,this,this.httpRequest,[e,t,a,i]),"get"==a?n.send(e+"?"+t,"",a,"text"):"post"==a&&n.send(e,JSON.stringify(t),a,"text")}static DoVibrate(e=!0){Laya.Browser.onWeiXin&&this.isVibrate&&(e?Laya.Browser.window.wx.vibrateShort():Laya.Browser.window.wx.vibrateLong())}static OpenAlert(e,t=2e3,a=!1){Laya.Browser.onWeiXin&&Laya.Browser.window.wx.showToast({title:e,duration:t,mask:!1,icon:a?"success":"none"})}static NavigateApp(e,t,a,i,n){if(Laya.Browser.onWeiXin){Laya.Browser.window.wx.navigateToMiniProgram({appId:e,path:t,success(e){console.log("打开成功"),n()},fail(e){console.log("打开失败"),i()}})}}static preViewImage(e){Laya.Browser.onWeiXin&&Laya.Browser.window.wx.previewImage({current:e,urls:[e]})}static aldEvent(e){Laya.Browser.onWeiXin&&Laya.Browser.window.wx.aldSendEvent(e)}static fixBtnTouchPos(e,t,a,n,s){r.getPlayerData().grade>=i.instance.dataConfig.front_pass_gate&&1==i.instance.dataConfig.is_allow_area&&this.allowScene()?(e.y=t*Laya.stage.displayHeight/1334,Laya.timer.once(1100,n,()=>{h.instance.showBanner()}),Laya.timer.once(1200,n,()=>{e.y=a,s&&s()})):(h.instance.showBanner(),s&&s())}static isValidBanner(){return r.getPlayerData().grade>=i.instance.dataConfig.front_pass_gate&&1==i.instance.dataConfig.is_allow_area&&this.allowScene()}static allowScene(){let e=i.instance.dataConfig.front_wuchu_scene.split("|");console.log("sArr:",e),console.log("sceneId:",c.sceneId);for(let t=0;t<e.length;t++){if(parseInt(e[t])==c.sceneId)return console.log("allowScene:",!1),!1}return console.log("allowScene:",!0),!0}static calculateShareNumber(){localStorage.getItem("lastDate")&&(new Date).getDate()==parseInt(localStorage.getItem("lastDate"))?this.front_share_number=parseInt(localStorage.getItem("front_share_number")):this.front_share_number=i.instance.dataConfig.front_share_number,console.log("this.front_share_number:",this.front_share_number)}}c.UnityPath="LayaScene_MyScene/Conventional/",c.openId="",c.version="1.0.17",c.isVibrate=!0,c.isMusic=!0,c.OnShowFun=null,c.scopeBtn=null,c.shareCallback=null,c.front_share_number=0,c.sceneId=0,c.gotOfflineBounes=!1,c.configData=null,c.shareTime=0,c.firstShare=!0,c.hadShowFriendUI=!1,c.launchGameUI=!1,c.firstStartGame=!1,c.isKillBossUI=!1,c.fromKillBossUI=!1,c.tempGrade=1;class d extends Laya.Script{constructor(){super(),this.myOwner=null,this._ani=null,this.isHited=!1,this.isDied=!1,this.hp=100}onAwake(){this.myOwner=this.owner,this._ani=this.owner.getComponent(Laya.Animator)}onDisable(){}playDied(){this._ani.speed=1,this._ani.crossFade("Take 001",.05)}hitBack(e){if(this.isDied||this.isHited)return;let t=n.GetRandom(1,3);if(o.instance.playSoundEffect("castleHit"+t+".mp3"),c.DoVibrate(),n.objectShake(this.myOwner,.2,.1),this.hp-=e,this.hp<=0)return this.isDied=!0,this.playDied(),void Laya.timer.once(1e3,this,()=>{this.owner.destroy()});this.isHited=!0,Laya.timer.once(500,this,()=>{this.isHited=!1})}}class y{constructor(){this.tCount=0,y.Share=this,this.init()}init(){localStorage.getItem("powerTime")?this.tCount=parseInt(localStorage.getItem("powerTime")):localStorage.setItem("power","0"),this.calculateExitTime(),Laya.Browser.onWeiXin&&(Laya.Browser.window.wx.onShow(e=>{this.calculateExitTime()}),Laya.Browser.window.wx.onHide(e=>{localStorage.setItem("powerTime",this.tCount.toString()),localStorage.setItem("exitTime",(new Date).getTime().toString())})),Laya.timer.loop(1e3,this,this.calculateTime)}calculateExitTime(){let e=0;if(localStorage.getItem("exitTime")&&(e=(new Date).getTime()-parseInt(localStorage.getItem("exitTime"))),e<=0)return;e/=1e3;let t=Math.floor(e/600);r.getPlayerData().power+=t,r.getPlayerData().power>10&&(r.getPlayerData().power=10,r.setPlayerData())}calculateTime(){this.tCount<=0?r.getPlayerData().power<10?this.tCount=600:this.tCount=0:(this.tCount--,this.tCount<=0&&r.getPlayerData().power<10&&(r.getPlayerData().power+=1,r.setPlayerData(),this.tCount=r.getPlayerData().power<10?600:0))}}class p extends Laya.Script{constructor(){super(),this.navIndex=0}onEnable(){p.Share=this,this.calculateTime(),Laya.timer.loop(1e3,this,this.calculateTime),this.initData(),this.initNavItem(),Laya.timer.loop(3e3,this,this.initNavItem),n.rotateLoop(this.navItem,10,400)}initData(){this.coinNum.value=r.getPlayerData().coin.toString(),this.powerNum.value=r.getPlayerData().power.toString(),this.gradeNum.text=r.getPlayerData().grade.toString(),this.bar.width=(r.getPlayerData().gradeIndex+1)/4*480,this.bossPic.visible=this.bar.width>=480;let e=0==Math.floor(r.getPlayerData().grade%4)?4:Math.floor(r.getPlayerData().grade%4);for(let t=0;t<this.keyNode.numChildren;t++){this.keyNode.getChildAt(t).skin=e>t+1?"mainUI/sy-ys1.png":"mainUI/sy-ys2.png"}}onDisable(){Laya.timer.clearAll(this)}calculateTime(){let e=y.Share.tCount,t=Math.floor(e/60),a=Math.floor(e-60*t);this.powerTime.text=t.toString()+":"+a.toString(),this.powerNum.value=r.getPlayerData().power.toString(),this.powerTime.visible=r.getPlayerData().power<10}initNavItem(){let e=this.navIndex,t=this.navItem.getChildAt(0);t.skin=i.instance.navDataArr[e].icon,t.off(Laya.Event.CLICK,this,this.navCB),t.on(Laya.Event.CLICK,this,this.navCB,[e]),this.navIndex++,this.navIndex>=i.instance.navDataArr.length&&(this.navIndex=0)}navCB(e){c.aldEvent("首页导出位-总点击数"),i.instance.NavigateApp(e,()=>{w.Share.pauseGame=!0,i.instance.openScene(t.SCENE_RECOMMENDUI,!1,{closeCallbackFun:()=>{w.Share.pauseGame=!1},showContinue:!0})},()=>{c.aldEvent("首页导出位-总成功跳转数")})}}!function(e){e.HpBar="prefab/hpBar.prefab",e.Smile="prefab/smile.prefab",e.Cry="prefab/cry.prefab",e.Coin="prefab/coinEffect.prefab"}(a||(a={}));class g{constructor(){this.init(),Laya.loader.load(this.url,Laya.Handler.create(this,this.loadComplete),Laya.Handler.create(this,this.loadProgress),Laya.Loader.PREFAB)}static instance(){return g._instance?g._instance:g._instance=new g}init(){this.url=[];for(let e in a)this.url.push(a[e])}getItem(e){let t=Laya.loader.getRes(e);return t?Laya.Pool.getItemByCreateFun(e,t.create,t):null}recoverItem(e,t){Laya.Pool.recover(e,t)}loadProgress(e){console.log("预制体资源加载中...",e)}loadComplete(){console.log("预制体资源加载完成!")}}class L extends Laya.Script{constructor(){super(),this.playerNode=null,this.playerCrl=null,this.ready=!1}onAwake(){this.myOwner=this.owner}onDisable(){}initData(e){this.playerNode=e,this.ready=!0,this.playerCrl=this.playerNode.getComponent(C)}onUpdate(){if(!this.ready)return;if(null==this.playerNode.transform||null==this.playerNode.transform)return void this.myOwner.destroy();this.myOwner.value=this.playerCrl.hp/this.playerCrl.hpMax;let e=new Laya.Vector4(0,0,0),t=this.playerNode.transform.position.clone();this.playerCrl.isPlayer?t.z-=1:t.y+=4,w.Share._camera.viewport.project(t,w.Share._camera.projectionViewMatrix,e),this.myOwner.pos(e.x/Laya.stage.clientScaleX,e.y/Laya.stage.clientScaleY)}}class u extends Laya.Script{constructor(){super(),this.playerNode=null,this.playerCrl=null,this.ready=!1}onAwake(){this.myOwner=this.owner}onDisable(){}initData(e){this.playerNode=e,this.playerCrl=this.playerNode.getComponent(C),this.ready=!0,Laya.timer.once(2e3,this,()=>{this.myOwner.destroy()})}onUpdate(){if(!this.ready)return;if(null==this.playerNode.transform||null==this.playerNode.transform)return void this.myOwner.destroy();let e=new Laya.Vector4(0,0,0),t=this.playerNode.transform.position.clone();t.y+=3.5,w.Share._camera.viewport.project(t,w.Share._camera.projectionViewMatrix,e),this.myOwner.pos(e.x/Laya.stage.clientScaleX,e.y/Laya.stage.clientScaleY)}}class m extends Laya.Scene{constructor(){super(),this.touchPanel=this.touchPanel,this.touchNode=this.touchNode,this.drawSp=this.drawSp,this.btnNode=this.btnNode,this.noPowerNode=this.noPowerNode,this.upgradeNode=this.upgradeNode,this.closeUpgradePlane=this.closeUpgradePlane,this.moveNode=this.moveNode,this.item1=this.item1,this.item2=this.item2,this.item3=this.item3,this.getPowerBtn=this.getPowerBtn,this.upgradeBtn=this.upgradeBtn,this.skinBtn=this.skinBtn,this.reviveBtn=this.reviveBtn,this.startBtn=this.startBtn,this.overNode=this.overNode,this.bottomNode=this.bottomNode,this.gameOverNode=this.gameOverNode,this.helpBtn=this.helpBtn,this.giveUpBtn=this.giveUpBtn,this.gameOverBtnNode=this.gameOverBtnNode,this.playerHp=this.playerHp,this.aiHp=this.aiHp,this.moreGameBtn=this.moreGameBtn,this.drawGameBtn=this.drawGameBtn,this.touchStarted=!1,this.startPos=null,this.lineArr=[],this.lineArrVec2=[]}onOpened(e){m.Share=this,this.initData(),e&&e(),Laya.timer.frameLoop(1,this,this.checkIsNoPower);let a=!1;c.launchGameUI||(c.GetLaunchParam(e=>{let t=r.getPlayerData().exitTime;if(t>0){let e=(new Date).getTime(),i=Math.floor((e-t)/1e3/60);i>=1&&(Laya.Scene.open("MyScenes/OfflineUI.scene",!1,i),a=!0)}}),c.launchGameUI=!0,w.Share.checkCanUpgrade()),a||c.hadShowFriendUI||(c.hadShowFriendUI=!0,i.instance.openScene(t.SCENE_FRIENDGAME,!1,{closeCallbackFun:()=>{i.instance.dataConfig.front_index_video?h.instance.showVideo(()=>{}):i.instance.openScene(t.SCENE_RECOMMENDUI,!1)}})),this.drawTips.visible=r.getPlayerData().grade<=2,this.drawTips.skin=1==r.getPlayerData().grade?"mainUI/sy_ck2.png":"mainUI/sy_ck1.png",localStorage.getItem("guide")||1!=r.getPlayerData().grade?this.fingerAni.visible=!1:this.fingerAni.visible=!0,o.instance.playMusic("bgm.mp3"),0==w.Share.banGameUIBanner?h.instance.hideBanner():w.Share.banGameUIBanner=!0}onClosed(){Laya.timer.clearAll(this)}initData(){this.touchPanel.y=n.fixPosY(this.touchPanel.y),this.bottomNode.y=n.fixPosY(this.bottomNode.y),this.gameOverBtnNode.y=n.fixPosY(this.gameOverBtnNode.y),this.touchNode.on(Laya.Event.MOUSE_DOWN,this,this.touchStart),this.touchNode.on(Laya.Event.MOUSE_MOVE,this,this.touchMove),this.touchNode.on(Laya.Event.MOUSE_UP,this,this.touchEnd),this.touchNode.on(Laya.Event.MOUSE_OUT,this,this.touchOut),this.upgradeBtn.on(Laya.Event.CLICK,this,this.upgradeBtnCB),this.skinBtn.on(Laya.Event.CLICK,this,this.skinBtnCB),this.item1.on(Laya.Event.CLICK,this,this.upgradePlayerCountCB),this.item2.on(Laya.Event.CLICK,this,this.upgradePlayerAtkCB),this.item3.on(Laya.Event.CLICK,this,this.upgradeOfflineCB),this.reviveBtn.on(Laya.Event.CLICK,this,this.reviveBtnCB),this.startBtn.on(Laya.Event.CLICK,this,this.startCB),this.helpBtn.on(Laya.Event.CLICK,this,this.helpBtnCB),this.giveUpBtn.on(Laya.Event.CLICK,this,this.giveUpBtnCB),this.getPowerBtn.on(Laya.Event.CLICK,this,this.getPowerBtnCB),this.moreGameBtn.on(Laya.Event.CLICK,this,this.moreGameBtnCB),this.drawGameBtn.on(Laya.Event.CLICK,this,this.drawGameBtnCB),n.rotateLoop(this.drawGameBtn.getChildAt(0),20,200),n.scaleLoop(this.moreGameBtn,1.1,500),this.updatePlayerItem(),Laya.timer.loop(1e3,this,this.updatePlayerItem),w.Share.canTouch=!0}updatePlayerItem(){let e=null,t=!1;for(let a=1;a<=3;a++){let i=(e=this["item"+a]).getChildByName("lvNum"),n=e.getChildByName("cost"),s=e.getChildByName("panel");switch(a){case 1:i.text="等级："+r.getPlayerCountLv().toString(),n.text=r.getUpgradePlayerCountLvCost().toString(),s.visible=r.getUpgradePlayerCountLvCost()>r.getPlayerData().coin||r.getCountLvMax();break;case 2:i.text="等级："+r.getPlayerPowerLv().toString(),n.text=r.getUpgradePlayerPowerLvCost().toString(),s.visible=r.getUpgradePlayerPowerLvCost()>r.getPlayerData().coin||r.getPowerLvMax();break;case 3:i.text="等级："+r.getPlayerOfflineLv().toString(),n.text=r.getUpgradeOfflineLvCost().toString(),s.visible=r.getUpgradeOfflineLvCost()>r.getPlayerData().coin||r.getOfflineLvMax()}s.visible||(t=!0)}this.upgradeBtn.getChildAt(0).visible=t}touchStart(e){this.safeArea(new Laya.Vector2(e.stageX,e.stageY))&&w.Share.canTouch&&(this.fingerAni.visible=!1,localStorage.getItem("guide")||localStorage.setItem("guide","1"),0!=r.getPlayerData().gradeIndex||w.Share.gameStarted||(r.getPlayerData().power--,r.setPlayerData(),w.Share.gameStarted=!0),this.touchStarted=!0,this.startPos=new Laya.Vector2(e.stageX,e.stageY),this.lineArr=[],this.lineArr.push(this.startPos.x),this.lineArr.push(this.startPos.y),this.lineArrVec2=[],this.lineArrVec2.push(this.startPos))}touchMove(e){if(!this.safeArea(new Laya.Vector2(e.stageX,e.stageY))||!this.touchStarted)return;let t=new Laya.Vector2(e.stageX,e.stageY);n.calcDistance(this.startPos,t)>=10&&this.lineArrVec2.length<w.WEAPON_LENGTH_MAX&&(this.lineArr.push(t.x),this.lineArr.push(t.y),this.lineArrVec2.push(t),this.startPos=t,this.drawLine())}touchEnd(e){this.touchStarted&&(this.touchStarted=!1,this.drawSp.graphics.clear(),this.lineArrVec2.length<w.WEAPON_LENGTH_MIN?c.OpenAlert("武器太短啦，请重画！"):w.Share.createLine3D(this.lineArrVec2))}touchOut(e){this.touchStarted&&(this.touchStarted=!1,this.drawSp.graphics.clear(),this.lineArrVec2.length<w.WEAPON_LENGTH_MIN?c.OpenAlert("武器太短啦，请重画！"):w.Share.createLine3D(this.lineArrVec2))}drawLine(){this.drawSp.graphics.clear(),this.drawSp.graphics.drawLines(0,0,this.lineArr,"#000000",8)}safeArea(e){let t=this.touchPanel.x-this.touchPanel.width/2,a=this.touchPanel.x+this.touchPanel.width/2,i=this.touchPanel.y-this.touchPanel.height/2,n=this.touchPanel.y+this.touchPanel.height/2;return!(e.x<t||e.x>a||e.y<i||e.y>n)}upgradeBtnCB(){this.upgradeNode.visible||(c.aldEvent("首页升级按钮：点击"),this.upgradeNode.visible=!0,n.tMove2D(this.moveNode,-606,this.moveNode.y,200,()=>{this.closeUpgradePlane.off(Laya.Event.CLICK,this,this.closeUpgradeNode),this.closeUpgradePlane.on(Laya.Event.CLICK,this,this.closeUpgradeNode)}))}closeUpgradeNode(){this.closeUpgradePlane.off(Laya.Event.CLICK,this,this.closeUpgradeNode),n.tMove2D(this.moveNode,0,this.moveNode.y,200,()=>{this.upgradeNode.visible=!1})}skinBtnCB(){console.log("点击皮肤按钮"),c.aldEvent("皮肤界面：点击"),Laya.Scene.open("MyScenes/SkinUI.scene",!1,()=>{})}upgradePlayerCountCB(){console.log("点击升级人数"),r.getPlayerCountLv()>=5||(r.getPlayerData().coin<r.getUpgradePlayerCountLvCost()?c.OpenAlert("金币不足！"):(c.aldEvent("升级界面：人数"),r.changeCoin(-r.getUpgradePlayerCountLvCost()),r.upgradePlayerCountLv(),this.updatePlayerItem(),w.Share.upgradePlayerCount(),p.Share.initData()))}upgradePlayerAtkCB(){console.log("点击升级攻击力"),r.getPlayerPowerLv()>=35||(r.getPlayerData().coin<r.getUpgradePlayerPowerLvCost()?c.OpenAlert("金币不足！"):(c.aldEvent("升级界面：攻击力"),r.changeCoin(-r.getUpgradePlayerPowerLvCost()),r.upgradePlayerPowerLv(),this.updatePlayerItem(),p.Share.initData()))}upgradeOfflineCB(){console.log("点击升级离线收益"),r.getPlayerOfflineLv()>=56||(r.getPlayerData().coin<r.getUpgradeOfflineLvCost()?c.OpenAlert("金币不足！"):(c.aldEvent("升级界面：离线收益"),r.changeCoin(-r.getUpgradeOfflineLvCost()),r.upgradePlayerOfflineLv(),this.updatePlayerItem(),p.Share.initData()))}visibleOverNode(e){e&&c.aldEvent("复活战士按钮弹出展示"),this.touchPanel.visible=!e,this.overNode.visible=e,this.upgradeBtn.visible=!e,this.skinBtn.visible=!e}reviveBtnCB(){w.Share.revivePlayer(),this.visibleOverNode(!1)}startCB(){this.visibleOverNode(!1),w.Share.goAhead()}visibleBottomUI(e){this.touchPanel.visible=e,this.upgradeBtn.visible=e,this.skinBtn.visible=e,e?h.instance.hideBanner():h.instance.showBanner()}visibleGameOverNode(e){e&&!this.gameOverNode.visible?(i.instance.closeScene(t.SCENE_DRAWUI),c.fixBtnTouchPos(this.giveUpBtn,300,82,this),i.instance.openScene(t.SCENE_FINISHGAMEUI,!1,{posY:600,fixY:!0})):e||(h.instance.hideBanner(),i.instance.closeScene(t.SCENE_FINISHGAMEUI)),this.gameOverNode.visible=e}helpBtnCB(){c.aldEvent("请求帮助：点击");l.instance.shareGame(()=>{c.aldEvent("请求帮助：成功"),this.visibleGameOverNode(!1),w.Share.isOver=!1,w.Share.isHelpStart=!0,w.Share.tempPlayerCount=1,w.Share.restartGame()})}giveUpBtnCB(){i.instance.openScene(t.SCENE_FULLGAMEUI,!1,{grade:r.getPlayerData().grade,continueCallbackFun:()=>{c.aldEvent("第"+r.getPlayerData().grade+"关：失败"),w.Share.isHelpStart=!1,w.Share.gradeIndex=0,r.getPlayerData().gradeIndex=0,r.setPlayerData(),this.visibleGameOverNode(!1),w.Share.restartGame(),i.instance.openScene(t.SCENE_NEWGAMEUI,!1)}})}createHpBar(e){let t=g.instance().getItem(a.HpBar);this.playerHp.addChild(t),t.addComponent(L).initData(e)}createSmile(e){let t=g.instance().getItem(a.Smile);this.addChild(t),t.getComponent(u).initData(e)}createCry(e){let t=g.instance().getItem(a.Cry);this.addChild(t),t.getComponent(u).initData(e)}getPowerBtnCB(){c.aldEvent("获得体力：点击");l.instance.shareGame(()=>{c.aldEvent("获得体力：成功"),r.getPlayerData().power+=5,r.setPlayerData()})}checkIsNoPower(){if(0==r.getPlayerData().gradeIndex&&!w.Share.gameStarted&&!w.Share.isHelpStart){let e=r.getPlayerData().power;this.touchPanel.visible=e>0,this.touchNode.visible=e>0,this.noPowerNode.visible=e<=0}}createCoinBoom(e){let t=new Laya.Vector4(0,0,0),a=e.transform.position.clone();a.y+=1.75,w.Share._camera.viewport.project(a,w.Share._camera.projectionViewMatrix,t);let i=new Laya.Vector2(t.x/Laya.stage.clientScaleX,t.y/Laya.stage.clientScaleY),s=new Laya.Vector2(75,100);n.coinCollectAnim(i,s,this),p.Share.initData()}moreGameBtnCB(){w.Share.getIsOver()||(c.aldEvent("更多游戏导出页-总点击数"),w.Share.pauseGame=!0,i.instance.closeScene(t.SCENE_DRAWUI),i.instance.openScene(t.SCENE_RECOMMENDUI,!1,{closeCallbackFun:()=>{w.Share.gameStarted&&!this.touchPanel.visible&&h.instance.showBanner(),w.Share.pauseGame=!1,i.instance.openScene(t.SCENE_DRAWUI,!1,{autoTime:1500})},showContinue:!0}))}drawGameBtnCB(){w.Share.getIsOver()||(c.aldEvent("抽屉导出页-总点击数"),w.Share.gameStarted?i.instance.openScene(t.SCENE_DRAWUI,!1,{autoTime:1500}):i.instance.openScene(t.SCENE_DRAWUI))}}class C extends Laya.Script{constructor(){super(),this.myOwner=null,this._ani=null,this.weaponNode=null,this.enemyNode=null,this.embNode=null,this.closeNode=null,this.isPlayer=!0,this.isHited=!1,this.haveWeapon=!1,this.isDied=!1,this.fightStarted=!1,this.weaponLength=5,this.walkSpeed=.08,this.myId=0,this.backDistance=8,this.weaponSpeed=1,this.hpMax=100,this.hp=100,this.atk=20,this.embScale=null,this.embPos=null,this.embRotation=null,this.isBossState=!1}onAwake(){this.myOwner=this.owner,this._ani=this.owner.getComponent(Laya.Animator),this.playIdle1(),this.weaponNode=n.findNodeByName(this.myOwner,"Dummy_Arms"),this.embNode=n.findNodeByName(this.myOwner,"Dummy_Emb");let e=n.findNodeByName(this.myOwner,"Hero1_Emb");this.embScale=e.transform.localScale.clone(),this.embPos=e.transform.localPosition.clone(),this.embRotation=e.transform.localRotation.clone()}initData(e,t){this.myId=e,this.isPlayer=t,this.isPlayer||this.playIdle2(),t&&(this.changeSkin(-1!=r.freeSkinId?r.freeSkinId:r.getPlayerData().playerId),this.hp=r.getPlayerPowerData().hp,this.hpMax=this.hp,this.atk=r.getPlayerPowerData().atk)}playIdle1(){this._ani.speed=1,this._ani.crossFade("idle1",.05)}playIdle2(){this._ani.speed=1,this._ani.crossFade("idle2",.05)}playWalk(){this._ani.play("walk",0,0),this._ani.crossFade("hit",.05,1),this._ani.getControllerLayer(1).getAnimatorState("hit").speed=this.getPlayerAniSpeed()}playDied(){this._ani.crossFade("died",.05),this._ani.getControllerLayer(1).getAnimatorState("hit").speed=0}getPlayerAniSpeed(){let e=this.weaponLength;return e>50?this.weaponSpeed-this.weaponSpeed*(e-50)*.01:this.weaponSpeed}getHitbackDistance(){let e=this.weaponLength;return e>50?this.backDistance-this.backDistance*(e-50)*.01:this.backDistance}addWeapon(e){this.weaponNode.addChild(e),this.weaponLength=this.weaponNode.getChildAt(0).numChildren>100?100:this.weaponNode.getChildAt(0).numChildren,e.transform.localPosition=new Laya.Vector3(0,0,0),this.haveWeapon=!0,this.weaponNode.numChildren>30&&(this.atk=this.atk*(1+.005*(this.weaponNode.numChildren-30))),this.isPlayer&&o.instance.playSoundEffect("weaponReady.mp3"),this.playIdle2()}removeWeapon(){this.weaponNode.destroyChildren()}goToFight(e){this.isPlayer?(this.hp==this.hpMax&&(this.hp=r.getPlayerPowerData().hp,this.hpMax=this.hp),this.atk=r.getPlayerPowerData().atk):(this.hp==this.hpMax&&(this.hp=r.getNpcData().hp,this.hpMax=this.hp),this.atk=r.getNpcData().atk),this.fightStarted=!0,this.enemyNode=e,this.isBossState=r.getPlayerData().gradeIndex>=3,this.playWalk()}onUpdate(){if(this.enemyNode&&this.enemyNode.numChildren>0&&!this.isHited&&!this.isDied&&this.fightStarted&&!w.Share.pauseGame){let e=this.myOwner.transform.position.clone(),t=99999,a=null;for(let i=0;i<this.enemyNode.numChildren;i++){let n=this.enemyNode.getChildAt(i);if(!n||!n.transform)continue;let s=n.getComponent(C);if(s&&s.isDied)continue;let r=Laya.Vector3.distance(e,n.transform.position.clone());r<t&&(t=r,a=n)}if(this.closeNode&&this.closeNode.transform&&this.closeNode.getComponent(C)&&!this.closeNode.getComponent(C).isDied?a=this.closeNode:(this.closeNode=null,this.closeNode=a),!a)return;this.myOwner.transform.lookAt(a.transform.position,new Laya.Vector3(0,1,0)),this.myOwner.transform.rotate(new Laya.Vector3(0,180,0),!0,!1);let i=n.getDirectionAToB(this.myOwner,a);i=new Laya.Vector3(i.x*this.walkSpeed,i.y*this.walkSpeed,i.z*this.walkSpeed);let s=new Laya.Vector3(0,0,0);if(Laya.Vector3.add(e,i,s),this.isBossState&&t<6)return;if(!this.isBossState&&t<.5)return;this.myOwner.transform.position=s}}onLateUpdate(){this.weaponNode&&this.enemyNode&&this.enemyNode.numChildren>0&&!this.isHited&&!this.isDied&&this.fightStarted&&!w.Share.pauseGame&&this.checkIsHitEnemy()}checkIsHitEnemy(){let e=this.weaponNode.getChildAt(0);if(e&&null!=e&&null!=e&&!this.isDied)for(let t=0;t<e.numChildren;t++){let a=e.getChildAt(t),i=a.transform.position.clone();i.y=0;for(let e=0;e<this.enemyNode.numChildren;e++){let t=this.enemyNode.getChildAt(e),n=t.transform.position.clone();n.y=0;let s=Laya.Vector3.distance(i,n);if(!this.isBossState&&s<=1){return void t.getComponent(C).hitBack(a,this.atk,this.myOwner)}if(this.isBossState&&s<=5){return void t.getComponent(d).hitBack(this.atk)}}}}hitBack(e,t,a){if(this.isDied||this.isHited)return;this.isPlayer||c.DoVibrate();let i=n.GetRandom(1,4);if(o.instance.playSoundEffect("weaponHit"+i+".mp3"),this.createHitFX(),this.hp-=t,this.hp<=0){this.isPlayer?m.Share.createSmile(a):(m.Share.createCry(this.myOwner),m.Share.createCoinBoom(this.myOwner),r.changeCoin(10),o.instance.playSoundEffect("getCoin.mp3"));let e=n.GetRandom(1,2);return o.instance.playSoundEffect("die"+e+".mp3"),this.isDied=!0,this.playDied(),void Laya.timer.once(1e3,this,()=>{this.owner.destroy()})}this.isHited=!0;let s=e.transform.position.clone(),l=this.myOwner.transform.position.clone(),h=new Laya.Vector3(0,0,0);Laya.Vector3.subtract(l,s,h),Laya.Vector3.normalize(h,h),h=new Laya.Vector3(h.x*this.getHitbackDistance(),0,h.z*this.getHitbackDistance());let d=this.myOwner.transform.position.clone();Laya.Vector3.add(d,h,d),n.TmoveTo(this.myOwner,200,d,()=>{this.isHited=!1})}createHitFX(){let e=Laya.loader.getRes(c.UnityPath+"hitFX.lh"),t=Laya.Sprite3D.instantiate(e,this.myOwner,!0,new Laya.Vector3(0,2,0));t.transform.localPosition=new Laya.Vector3(0,1.5,0),Laya.timer.once(1e3,w.Share,()=>{t.destroy()})}changeSkin(e){let t=new Laya.UnlitMaterial;Laya.Texture2D.load("res/skinHero/HeroD_"+(e+1)+".png",Laya.Handler.create(this,function(e){t.albedoTexture=e}));for(let e=1;e<=4;e++){this.owner.getChildAt(e).skinnedMeshRenderer.material=t}this.embNode.destroyChildren();let a=Laya.loader.getRes(c.UnityPath+"Hero"+(e+1)+"_Emb.lh"),i=Laya.Sprite3D.instantiate(a,this.embNode,!1,new Laya.Vector3(0,0,0));i.transform.localScale=this.embScale,i.transform.localPosition=this.embPos,i.transform.localRotation=this.embRotation}}const v=.1,S=3,f=30;class w{constructor(){this._playerNode=new Laya.Sprite3D,this._aiNode=new Laya.Sprite3D,this.circleEffect=new Laya.Sprite3D,this.camStartPos=new Laya.Vector3(0,0,0),this.canTouch=!1,this.gameStarted=!1,this.canReady=!1,this.isHelpStart=!1,this.pauseGame=!1,this.gradeIndex=0,this.tempPlayerCount=0,this.isOver=!1,this.banGameUIBanner=!1,this.gotKillBossBounes=!1,this.hadAutoShowUpgrade=!1,Laya.Browser.onWeiXin&&(c.sceneId=c.GetLaunchPassVar().scene,Laya.Browser.window.wx.onShow(e=>{c.sceneId=e.scene})),h.instance.initAd(),n.loadJson("res/config/aiConfig.json",e=>{r.aiConfig=e}),n.loadJson("res/config/posConfig.json",e=>{r.posConfig=e}),r.getPlayerData(),g.instance(),new y,r.getPlayerData().gradeIndex=0,this.gradeIndex=r.getPlayerData().gradeIndex,w.Share=this,c.WxOnHide(()=>{r.setExitTime(),localStorage.setItem("lastDate",(new Date).getDate().toString()),localStorage.setItem("front_share_number",c.front_share_number.toString())}),c.LoginWx((e,t)=>{i.instance.initJJ(e,c.version,e=>{c.calculateShareNumber(),l.instance.initShare(),this.loadAtlas(),Laya.Browser.window.wx.aldSendOpenid(e),console.log("上报openid:",e)})})}loadAtlas(){var e=[{url:"res/atlas/finishUI.atlas",type:Laya.Loader.ATLAS},{url:"res/atlas/finishUI.png",type:Laya.Loader.IMAGE},{url:"res/atlas/mainUI.atlas",type:Laya.Loader.ATLAS},{url:"res/atlas/mainUI.png",type:Laya.Loader.IMAGE},{url:"res/atlas/offlineUI.atlas",type:Laya.Loader.ATLAS},{url:"res/atlas/offlineUI.png",type:Laya.Loader.IMAGE},{url:"res/atlas/normalUI.atlas",type:Laya.Loader.ATLAS},{url:"res/atlas/normalUI.png",type:Laya.Loader.IMAGE},{url:"res/atlas/heroSkins.atlas",type:Laya.Loader.ATLAS},{url:"res/atlas/heroSkins.png",type:Laya.Loader.IMAGE},{url:"res/atlas/freeSkins.atlas",type:Laya.Loader.ATLAS},{url:"res/atlas/freeSkins.png",type:Laya.Loader.IMAGE},{url:"res/atlas/skinUI.atlas",type:Laya.Loader.ATLAS},{url:"res/atlas/skinUI.png",type:Laya.Loader.IMAGE},{url:"res/atlas/boxUI.atlas",type:Laya.Loader.ATLAS},{url:"res/atlas/boxUI.png",type:Laya.Loader.IMAGE}];Laya.loader.load(e,Laya.Handler.create(this,function(){Laya.Scene.open("MyScenes/LoadingUI.scene")}))}initScene(){Laya.Scene3D.load(c.UnityPath+"MyScene.ls",Laya.Handler.create(this,this.onLoadScene))}onLoadScene(e){this._scene=Laya.stage.addChild(e),Laya.stage.setChildIndex(this._scene,0),this._scene.addChild(this._playerNode),this._scene.addChild(this._aiNode),this._camera=this._scene.getChildByName("Main Camera"),this._light=this._scene.getChildByName("Directional Light"),this._plane=this._scene.getChildByName("Plane"),this.camStartPos=this._camera.transform.position.clone(),this.fixCameraField();let t=Laya.loader.getRes(c.UnityPath+"Circle_1.lh");this.circleEffect=Laya.Sprite3D.instantiate(t,this._scene,!0,new Laya.Vector3(0,.1,0)),this.circleEffect.active=!1,Laya.timer.frameLoop(1,this,this.updateCircle)}fixCameraField(){let e=(Laya.stage.displayHeight-1334<0?0:Laya.stage.displayHeight-1334)/290*10;this._camera.fieldOfView=70+e}moveCamera(e,t=2e3){let a=this._camera,i=a.transform.position.clone();i.z+=e,n.TmoveTo(a,t,i,()=>{})}createPlayer(){let e=Laya.loader.getRes(c.UnityPath+"Hero_1.lh"),t=(r.getPlayerCount()+this.tempPlayerCount-1)*S/2;for(let a=0;a<r.getPlayerCount()+this.tempPlayerCount;a++){let i=Laya.Sprite3D.instantiate(e,this._playerNode,!1,new Laya.Vector3(0,0,0));i.addComponent(C).initData(a,!0),i.transform.translate(new Laya.Vector3(t,0,f*this.gradeIndex),!1),t-=S,m.Share.createHpBar(i)}}pushPlayer(){let e=Laya.loader.getRes(c.UnityPath+"Hero_1.lh"),t=(r.getPlayerCount()-1)*S/2;for(let a=0;a<r.getPlayerCount();a++){if(a+1<=this._playerNode.numChildren){t-=S;let e=this._playerNode.getChildAt(a).getComponent(C);e.hp=e.hpMax;continue}let i=Laya.Sprite3D.instantiate(e,this._playerNode,!1,new Laya.Vector3(0,0,0));i.addComponent(C).initData(a,!0),i.transform.translate(new Laya.Vector3(t,0,f*this.gradeIndex),!1),t-=S,m.Share.createHpBar(i)}}updateCircle(){if(!this._playerNode||this._playerNode.numChildren<=0)this.circleEffect.active=!1;else{for(let e=0;e<this._playerNode.numChildren;e++){let t=this._playerNode.getChildAt(e);if(!t.getComponent(C).haveWeapon){let e=t.transform.position.clone(),a=new Laya.Vector3(e.x,.1,e.z+.1);return this.circleEffect.transform.position=a,void(this.circleEffect.active=!0)}}this.circleEffect.active=!1}}createAi(){if(r.getPlayerData().gradeIndex>=3)return void this.createBoss();let e=null,t=0,a=[],i=[],s=0;r.getPlayerData().grade>19?(a=r.posConfig.sort,t=n.GetRandom(0,9),i=n.getRandomItemInArr(a),s=n.GetRandom(1,7)):(t=(e=r.aiConfig["grade"+r.getPlayerData().grade]).skinId,i=(a=e.sort)[r.getPlayerData().gradeIndex]),this._aiNode.transform.position=new Laya.Vector3(0,0,10+f*this.gradeIndex);let o=Laya.loader.getRes(c.UnityPath+"Hero_1.lh"),l=S;for(let e=0;e<i.length;e++){let a=Laya.Sprite3D.instantiate(o,this._aiNode,!0,new Laya.Vector3(0,0,0)),n=a.addComponent(C);n.initData(e,!1),n.changeSkin(t),a.transform.localPosition.x=i[e][0]*l,a.transform.localPosition.y=0,a.transform.localPosition.z=i[e][1]*l,a.transform.rotate(new Laya.Vector3(0,180,0),!0,!1),m.Share.createHpBar(a);let h=r.getPlayerData().grade>19?s:i[e][2]+1,d=Laya.loader.getRes(c.UnityPath+"Arms_"+h+".lh"),y=Laya.Sprite3D.instantiate(d,null,!0,new Laya.Vector3(0,0,0));n.addWeapon(y)}}createBoss(){this._aiNode.transform.position=new Laya.Vector3(0,0,10+f*this.gradeIndex);let e=Laya.loader.getRes(c.UnityPath+"Hero_Boss.lh");e.getComponent(Laya.Animator).getControllerLayer().playOnWake=!1;let t=Laya.Sprite3D.instantiate(e,this._aiNode,!0,new Laya.Vector3(0,0,0));t.addComponent(d);t.transform.localPosition.x=0,t.transform.localPosition.y=0,t.transform.localPosition.z=0,t.transform.rotate(new Laya.Vector3(0,180,0),!0,!1)}createLine3D(e){let t=new Laya.Sprite3D,a=Laya.loader.getRes(c.UnityPath+"line.lh"),i=new Laya.Vector3(0,0,0);for(let n=0;n<e.length;n++)if(0==n){let e=Laya.Sprite3D.instantiate(a,t,!1,new Laya.Vector3(0,0,0));e.transform.position=new Laya.Vector3(0,0,0),i=e.transform.position.clone()}else{let s=new Laya.Vector3(-e[n-1].x,0,-e[n-1].y),r=new Laya.Vector3(-e[n].x,0,-e[n].y),o=t.getChildAt(t.numChildren-1).transform.position.clone(),l=Laya.Vector3.distance(s,r);for(let e=0;e<Math.floor(l/10);e++){let n=Laya.Sprite3D.instantiate(a,t,!1,new Laya.Vector3(0,0,0)),l=new Laya.Vector3(0,0,0);Laya.Vector3.subtract(r,s,l),Laya.Vector3.normalize(l,l);let h=v*(e+1);l=new Laya.Vector3(l.x*h,l.y*h,l.z*h);let c=new Laya.Vector3(0,0,0);Laya.Vector3.add(o,l,c),n.transform.position=c,n.transform.position.z<i.z&&(i=n.transform.position.clone())}}for(let e=0;e<t.numChildren;e++){let a=t.getChildAt(e),n=new Laya.Vector3(0,0,0);Laya.Vector3.subtract(a.transform.position,i,n),a.transform.position=n}for(let e=0;e<this._playerNode.numChildren;e++){let a=this._playerNode.getChildAt(e).getComponent(C);if(!a.haveWeapon){a.addWeapon(t);break}}this.checkWeaponed()&&this.readyGo()}checkWeaponed(){let e=!0;for(let t=0;t<this._playerNode.numChildren;t++){this._playerNode.getChildAt(t).getComponent(C).haveWeapon||(e=!1)}return e}readyGo(){if(r.getFreeSkins().length>0&&!this.canReady&&r.getPlayerData().grade>=i.instance.dataConfig.front_share_try&&0==r.getPlayerData().gradeIndex)Laya.Scene.open("MyScenes/FreeSkinUI.scene",!1);else{c.firstStartGame||(c.firstStartGame=!0,c.aldEvent("进入游戏后首次点击开始游戏")),0==r.getPlayerData().gradeIndex&&(c.aldEvent("开始游戏"),c.aldEvent("第"+r.getPlayerData().grade+"关：进入")),this.canTouch=!1,m.Share.visibleBottomUI(!1);for(let e=0;e<this._playerNode.numChildren;e++){this._playerNode.getChildAt(e).getComponent(C).goToFight(this._aiNode)}if(r.getPlayerData().gradeIndex<3)for(let e=0;e<this._aiNode.numChildren;e++){this._aiNode.getChildAt(e).getComponent(C).goToFight(this._playerNode)}Laya.timer.clear(this,this.checkIsOver),Laya.timer.frameLoop(1,this,this.checkIsOver)}}checkIsOver(){if(this._aiNode.numChildren<=0){if(this._playerNode.numChildren<=r.getPlayerCount()&&(this.tempPlayerCount=0),this.gradeIndex+=1,Laya.timer.clear(this,this.checkIsOver),this.gradeIndex>=4)return this.tempPlayerCount=0,c.tempGrade=r.getPlayerData().grade,r.getPlayerData().grade+=1,r.getPlayerData().gradeIndex=0,r.setPlayerData(),Laya.Scene.close("MyScenes/GameUI.scene"),Laya.Scene.open("MyScenes/KillBossUI.scene",!0,()=>{r.getPlayerData().grade-1>=i.instance.dataConfig.front_auto_history_level?i.instance.openScene(t.SCENE_PROGRAMUI,!1,{closeCallbackFun:()=>{this._playerNode.active=!0,Laya.Scene.open("MyScenes/FinishUI.scene",!1)}}):(this._playerNode.active=!0,Laya.Scene.open("MyScenes/FinishUI.scene",!1))}),void(this._playerNode.active=!1);r.getPlayerData().gradeIndex=this.gradeIndex,r.setPlayerData(),p.Share.initData(),Laya.timer.once(200,this,()=>{this.moveCamera(f,1800)});let e=(r.getPlayerCount()+this.tempPlayerCount-1)*S/2;for(let t=0;t<this._playerNode.numChildren;t++){let a=this._playerNode.getChildAt(t),i=a.getComponent(C);i.fightStarted=!1;let s=new Laya.Vector3(e-t*S,0,f*this.gradeIndex);n.TmoveTo(a,2e3,s,()=>{i.playIdle2()}),n.RotateTo(a,1e3,new Laya.Vector3(0,0,0),()=>{})}this.createAi(),Laya.timer.once(2e3,this,()=>{this.checkIsNeedCreatePlayer()})}if(this._playerNode.numChildren<=0&&!this.isOver){this.isOver=!0,this.tempPlayerCount=0,Laya.Scene.close("MyScenes/GameUI.scene");let e=()=>{w.Share.banGameUIBanner=!0,w.Share._playerNode.active=!0,w.Share._aiNode.active=!0,Laya.Scene.open("MyScenes/GameUI.scene",!1,()=>{m.Share.visibleGameOverNode(!0)})};w.Share._playerNode.active=!1,w.Share._aiNode.active=!1,c.tempGrade=r.getPlayerData().grade,Laya.Scene.open("MyScenes/KillBossUI.scene",!1,()=>{r.getPlayerData().grade>=i.instance.dataConfig.front_auto_history_level?i.instance.openScene(t.SCENE_PROGRAMUI,!1,{closeCallbackFun:e}):e()})}}getIsOver(){if(this._playerNode.numChildren<=0)return!0;{let e=!0;for(let t=0;t<this._playerNode.numChildren;t++){if(!this._playerNode.getChildAt(t).getComponent(C).isDied){e=!1;break}}return e}}checkIsNeedCreatePlayer(){this._playerNode.numChildren<r.getPlayerCount()&&this.gradeIndex<3?(h.instance.hideBanner(),m.Share.reviveBtnCB()):this.readyGo()}revivePlayer(){this.canTouch=!0,this.pushPlayer()}goAhead(){this.readyGo()}upgradePlayerCount(){this._playerNode.destroyChildren(),this.createPlayer()}changePlayerSkin(e){for(let t=0;t<this._playerNode.numChildren;t++){let a=this._playerNode.getChildAt(t).getComponent(C);e?a.changeSkin(e):a.changeSkin(r.getPlayerData().playerId)}}checkCanUpgrade(){let e=r.getPlayerData().coin;!this.hadAutoShowUpgrade&&0==r.getPlayerData().gradeIndex&&(e>=r.getUpgradePlayerCountLvCost()||e>=r.getUpgradePlayerPowerLvCost()||e>=r.getUpgradeOfflineLvCost())&&(this.hadAutoShowUpgrade=!0,m.Share.upgradeBtnCB())}restartGame(){this.isOver=!1,w.Share.gotKillBossBounes=!1,this.gameStarted=!1,0==r.getPlayerData().gradeIndex&&(this._camera.transform.position=this.camStartPos,this.isHelpStart||(this.canReady=!1,-1!=r.freeSkinId&&(r.freeSkinId=-1))),this._aiNode.destroyChildren(),this._playerNode.destroyChildren(),this.createAi(),this.createPlayer(),m.Share.visibleBottomUI(!0),this.canTouch=!0,p.Share.initData(),this.checkCanUpgrade()}}w.WEAPON_LENGTH_MAX=100,w.WEAPON_LENGTH_MIN=10;class B extends Laya.Scene{constructor(){super(),this.rootNode=this.rootNode,this.closeBtn=this.closeBtn,this.navList=this.navList,this.navData=[],this.scrollDir=1,this.preIndex=-1,this.closeCallbackFun=null,this.autoTime=0}onOpened(t){t&&t.closeCallbackFun&&(this.closeCallbackFun=t.closeCallbackFun),t&&t.posY&&(this.rootNode.y=t.posY),t&&1==t.fixY&&e.fixNodeY(this.rootNode),t&&t.autoTime&&(this.autoTime=t.autoTime),this._init()}onClosed(){Laya.timer.clearAll(this),this.closeCallbackFun&&this.closeCallbackFun()}autoClose(){Laya.timer.once(this.autoTime,this,this.closeCB)}clearAutoClose(){Laya.timer.clear(this,this.closeCB)}_init(){this.closeBtn.on(Laya.Event.CLICK,this,this.closeCB),e.tMove(this.rootNode,0,this.rootNode.y,200,()=>{Laya.timer.once(1e3,this,()=>{Laya.timer.frameLoop(1,this,this.scrollLoop)})}),this.initList(),0!=this.autoTime&&this.autoClose()}initList(){this.navData=[].concat(i.instance.navDataArr),this.navList.vScrollBarSkin="",this.navList.repeatX=3,this.navList.repeatY=Math.floor(this.navData.length/3),this.navList.array=this.navData,this.navList.renderHandler=Laya.Handler.create(this,this.onListRender,null,!1),this.navList.mouseHandler=new Laya.Handler(this,this.mouseHandler)}mouseHandler(e,t){this.clearAutoClose(),this.againScroll()}againScroll(){Laya.timer.clear(this,this.scrollLoop),Laya.timer.once(1e3,this,()=>{Laya.timer.frameLoop(1,this,this.scrollLoop)})}scrollLoop(){let e=this.navList.scrollBar;e.value+=this.scrollDir,(e.value>=e.max||e.value<=0)&&(this.scrollDir=-this.scrollDir,this.againScroll())}onListRender(e,t){if(!(t>=this.navList.array.length)){var a=e.getChildByName("item"),n=a.getChildByName("icon"),s=a.getChildByName("name");n.skin=this.navData[t].icon,s.text=i.instance.getTitle(t),a.off(Laya.Event.CLICK,this,this.navCB,[t]),a.on(Laya.Event.CLICK,this,this.navCB,[t])}}navCB(e){console.log("click id:",e),w.Share.pauseGame=!0,i.instance.NavigateApp(e,()=>{w.Share.gameStarted&&(w.Share.pauseGame=!0),this.closeCB(),i.instance.openScene(t.SCENE_RECOMMENDUI,!1,{closeCallbackFun:()=>{w.Share.gameStarted&&!m.Share.touchPanel.visible&&h.instance.showBanner(),w.Share.pauseGame=!1,i.instance.openScene(t.SCENE_DRAWUI,!1,{autoTime:1200})},showContinue:!0})},()=>{w.Share.pauseGame=!0},t.SCENE_DRAWUI)}closeCB(){e.tMove(this.rootNode,-600,this.rootNode.y,200,()=>{this.close()})}}class I extends Laya.Script{constructor(){super(),this.isFix=!1}onAwake(){if(this.isFix){let t=this.owner;e.fixNodeY(t)}}onDestroy(){}}class N extends Laya.Scene{constructor(){super(),this.navList=this.navList,this.navData=[],this.from=null,this.totalArr=[],this.curIndex=6,this.fingerVecArr=[new Laya.Vector2(185,-38),new Laya.Vector2(446,-38),new Laya.Vector2(693,-38),new Laya.Vector2(185,205),new Laya.Vector2(446,205),new Laya.Vector2(693,205)]}onOpened(t){if(t){if(t.posY&&(this.navList.y=t.posY),1==t.fixY){e.fixNodeY(this.navList);let t=n.getRandomItemInArr(this.fingerVecArr);this.finger.x=t.x,this.finger.y=this.navList.y+t.y,this.bounesCoin.y=this.navList.y-260}t.from&&(this.from=t.from)}if(this.bounesCoin.visible=w.Share.gotKillBossBounes,w.Share.gotKillBossBounes){w.Share.gotKillBossBounes=!1;let e=n.GetRandom(30,100);this.bounesCoin.text="成功领取"+e+"金币",n.tMove2D(this.bounesCoin,this.bounesCoin.x,this.bounesCoin.y-100,2e3,()=>{this.bounesCoin.visible=!1}),r.changeCoin(e)}this._init()}onClosed(){Laya.timer.clearAll(this)}_init(){this.navData=[],this.totalArr=[].concat(i.instance.navDataArr),this.navData=this.totalArr.slice(0,6),this.initList()}initList(){this.navList.vScrollBarSkin="",this.navList.repeatX=3,this.navList.repeatY=2,this.navList.array=this.navData,this.navList.renderHandler=Laya.Handler.create(this,this.onListRender,null,!1)}onListRender(e,t){if(!(t>=this.navList.array.length)){var a=e.getChildByName("item");a.getChildByName("icon").skin=this.navData[t].icon,a.off(Laya.Event.CLICK,this,this.navCB,[this.totalArr.indexOf(this.navData[t]),t]),a.on(Laya.Event.CLICK,this,this.navCB,[this.totalArr.indexOf(this.navData[t]),t])}}navCB(e,a){console.log("click id:",e),"key"==this.from?Laya.Browser.window.wx.aldSendEvent("游戏成功导出页-总点击数"):"box"==this.from?Laya.Browser.window.wx.aldSendEvent("开启宝箱导出页-总点击数"):"fail"==this.from&&Laya.Browser.window.wx.aldSendEvent("游戏失败导出页-总点击数"),i.instance.NavigateApp(e,()=>{i.instance.openScene(t.SCENE_FULLGAMEUI,!1,{continueCallbackFun:()=>{h.instance.showBanner()}})},()=>{"key"==this.from?Laya.Browser.window.wx.aldSendEvent("游戏成功导出页-总成功跳转数"):"box"==this.from?Laya.Browser.window.wx.aldSendEvent("开启宝箱导出页-总成功跳转数"):"fail"==this.from&&Laya.Browser.window.wx.aldSendEvent("游戏失败导出页-总成功跳转数")},t.SCENE_FINISHGAMEUI),this.navData[a]=this.totalArr[this.curIndex],this.curIndex++,this.curIndex>=this.totalArr.length&&(this.curIndex=0),this.initList()}}const b=600;class D extends Laya.Scene{constructor(){super(),this.rootNode=this.rootNode,this.closeBtn=this.closeBtn,this.navList=this.navList,this.navData=[],this.scrollDir=1,this.preIndex=-1,this.closeCallbackFun=null}onOpened(e){e&&e.closeCallbackFun&&(this.closeCallbackFun=e.closeCallbackFun),this._init(),h.instance.showBanner()}onClosed(){h.instance.hideBanner(),Laya.timer.clearAll(this),this.closeCallbackFun&&this.closeCallbackFun()}_init(){this.rootNode.y=b,this.rootNode.y=this.rootNode.y*Laya.stage.displayHeight/Laya.stage.designHeight,this.closeBtn.on(Laya.Event.CLICK,this,this.closeCB),e.visibleDelay(this.closeBtn,1500),this.initList()}initList(){this.navData=[].concat(i.instance.navDataArr),this.navList.vScrollBarSkin="",this.navList.repeatX=3,this.navList.repeatY=Math.floor(this.navData.length/3),this.navList.array=this.navData,this.navList.renderHandler=Laya.Handler.create(this,this.onListRender,null,!1),this.navList.mouseHandler=new Laya.Handler(this,this.mouseHandler),Laya.timer.once(1e3,this,()=>{Laya.timer.frameLoop(1,this,this.scrollLoop)})}mouseHandler(e,t){this.againScroll()}againScroll(){Laya.timer.clear(this,this.scrollLoop),Laya.timer.once(1e3,this,()=>{Laya.timer.frameLoop(1,this,this.scrollLoop)})}scrollLoop(){let e=this.navList.scrollBar;e.value+=this.scrollDir,(e.value>=e.max||e.value<=0)&&(this.scrollDir=-this.scrollDir,this.againScroll())}onListRender(e,t){if(!(t>=this.navList.array.length)){var a=e.getChildByName("item"),n=a.getChildByName("icon"),s=a.getChildByName("name");n.skin=this.navData[t].icon,s.text=i.instance.getTitle(t),a.off(Laya.Event.CLICK,this,this.navCB,[t]),a.on(Laya.Event.CLICK,this,this.navCB,[t])}}navCB(e){console.log("click id:",e),i.instance.NavigateApp(e,()=>{i.instance.openScene(t.SCENE_FULLGAMEUI,!1)},null,t.SCENE_FRIENDGAME)}closeCB(){this.close()}}class E extends Laya.Scene{constructor(){super(),this.exitBtn=this.exitBtn,this.continueBtn=this.continueBtn,this.navList=this.navList,this.randBtn=this.randBtn,this.navData=[],this.scrollDir=1,this.preIndex=-1,this.hotArr=[],this.continueCallbackFun=null,this.curGrade=-1}onOpened(e){e&&e.continueCallbackFun&&(this.continueCallbackFun=e.continueCallbackFun),e&&e.grade&&(this.curGrade=e.grade),this._init(),h.instance.hideBanner(),Laya.timer.frameLoop(1,this,()=>{h.instance.hideBanner(!1)})}onClosed(){Laya.timer.clearAll(this)}_init(){this.exitBtn.on(Laya.Event.CLICK,this,this.closeCB),this.continueBtn.on(Laya.Event.CLICK,this,this.continueCB),this.randBtn.on(Laya.Event.CLICK,this,this.randBtnCB),this.randBtn.visible=i.instance.dataConfig.front_swtich_randompaly,this.exitBtn.visible=i.instance.dataConfig.front_swtich_return,this.randBtn.visible&&c.aldEvent("随机玩一个按钮-弹出次数"),e.fixNodeY(this.continueBtn),e.visibleDelay(this.continueBtn,i.instance.dataConfig.front_export_delay),this.getHotRandArr(),this.initList(),i.instance.NavigateApp(Math.floor(Math.random()*this.navData.length),null,null,t.SCENE_FULLGAMEUI)}getHotRandArr(){let t=[0,1,2,3,4,5,6,7,8];t=e.shuffleArr(t),this.hotArr=t.slice(0,3)}initList(){this.navData=[].concat(i.instance.navDataArr),this.navList.vScrollBarSkin="",this.navList.repeatX=3,this.navList.repeatY=Math.floor(this.navData.length/3),this.navList.array=this.navData,this.navList.height=1050*Laya.stage.displayHeight/1334,this.navList.renderHandler=Laya.Handler.create(this,this.onListRender,null,!1),this.navList.mouseHandler=new Laya.Handler(this,this.mouseHandler),Laya.timer.once(1e3,this,()=>{Laya.timer.frameLoop(1,this,this.scrollLoop)})}mouseHandler(e,t){this.againScroll()}againScroll(){Laya.timer.clear(this,this.scrollLoop),Laya.timer.once(1e3,this,()=>{Laya.timer.frameLoop(1,this,this.scrollLoop)})}scrollLoop(){let e=this.navList.scrollBar;e.value+=this.scrollDir,(e.value>=e.max||e.value<=0)&&(this.scrollDir=-this.scrollDir,this.againScroll())}onListRender(e,t){if(!(t>=this.navList.array.length)){var a=e.getChildByName("item"),n=a.getChildByName("icon"),s=a.getChildByName("name"),r=a.getChildByName("hot");a.getChildByName("color").skin="JJExportRes/"+(Math.floor(t%9)+1)+".png",n.skin=this.navData[t].icon,s.text=i.instance.getTitle(t),r.visible=-1!=this.hotArr.indexOf(t),a.off(Laya.Event.CLICK,this,this.navCB,[t]),a.on(Laya.Event.CLICK,this,this.navCB,[t])}}navCB(e,a,n){console.log("click id:",e),i.instance.NavigateApp(e,()=>{i.instance.openScene(t.SCENE_PROGRAMUI)},()=>{a&&c.aldEvent("随机玩一个按钮-总成功跳转数")},t.SCENE_FULLGAMEUI)}closeCB(){this.close(),i.instance.openScene(t.SCENE_RECOMMENDUI,!1,{closeCallbackFun:()=>{i.instance.openScene(t.SCENE_FULLGAMEUI,!1,{continueCallbackFun:this.continueCallbackFun})}})}continueCB(){this.close(),-1!=this.curGrade&&this.curGrade-1>=i.instance.dataConfig.front_auto_remen_level?i.instance.openScene(t.SCENE_RECOMMENDUI,!1,{closeCallbackFun:()=>{this.continueCallbackFun&&this.continueCallbackFun()}}):this.continueCallbackFun&&this.continueCallbackFun()}randBtnCB(){c.aldEvent("随机玩一个按钮-总点击数");let e=Math.floor(6*Math.random());e>=this.navData.length&&(e=this.navData.length-1),this.navCB(e,!0)}}class k extends Laya.Script{constructor(){super()}onAwake(){let e=this.owner;e.y=e.y*Laya.stage.displayHeight/1334}}class _ extends Laya.Scene{constructor(){super(),this.closeBtn=this.closeBtn,this.navList=this.navList,this.navData=[],this.scrollDir=1,this.preIndex=-1,this.closeCallbackFun=null}onOpened(e){e&&e.closeCallbackFun&&(this.closeCallbackFun=e.closeCallbackFun),this._init(),Laya.timer.once(100,this,()=>{h.instance.showBanner()})}onClosed(){h.instance.hideBanner(),Laya.timer.clearAll(this),this.closeCallbackFun&&this.closeCallbackFun()}_init(){this.closeBtn.on(Laya.Event.CLICK,this,this.closeCB),e.visibleDelay(this.closeBtn,1500),this.initList()}initList(){this.navData=[].concat(i.instance.navDataArr),this.navList.vScrollBarSkin="",this.navList.repeatX=3,this.navList.repeatY=Math.floor(this.navData.length/3),this.navList.array=this.navData,this.navList.renderHandler=Laya.Handler.create(this,this.onListRender,null,!1),this.navList.mouseHandler=new Laya.Handler(this,this.mouseHandler),Laya.timer.once(1e3,this,()=>{Laya.timer.frameLoop(1,this,this.scrollLoop)})}mouseHandler(e,t){this.againScroll()}againScroll(){Laya.timer.clear(this,this.scrollLoop),Laya.timer.once(1e3,this,()=>{Laya.timer.frameLoop(1,this,this.scrollLoop)})}scrollLoop(){let e=this.navList.scrollBar;e.value+=this.scrollDir,(e.value>=e.max||e.value<=0)&&(this.scrollDir=-this.scrollDir,this.againScroll())}onListRender(e,t){if(!(t>=this.navList.array.length)){var a=e.getChildByName("item"),n=a.getChildByName("icon"),s=a.getChildByName("name");n.skin=this.navData[t].icon,s.text=i.instance.getTitle(t),a.off(Laya.Event.CLICK,this,this.navCB,[t]),a.on(Laya.Event.CLICK,this,this.navCB,[t])}}navCB(e){console.log("click id:",e),i.instance.NavigateApp(e,()=>{i.instance.openScene(t.SCENE_PROGRAMUI)},null,t.SCENE_NEWGAMEUI)}closeCB(){this.close()}}class P extends Laya.Scene{constructor(){super(),this.closeBtn=this.closeBtn,this.navList=this.navList,this.navData=[],this.scrollDir=1,this.preIndex=-1,this.closeCallbackFun=null,this.starArr=[0,1,2,3,4,5,6,7,8,9]}onOpened(e){if(e&&e.closeCallbackFun&&(this.closeCallbackFun=e.closeCallbackFun),this._init(),h.instance.hideBanner(),Laya.timer.frameLoop(1,this,()=>{h.instance.hideBanner(!1)}),this.starArr=n.shuffleArr(this.starArr),this.starArr=this.starArr.splice(0,6),this.bounesCoin.visible=w.Share.gotKillBossBounes,w.Share.gotKillBossBounes){w.Share.gotKillBossBounes=!1;let e=n.GetRandom(30,100);this.bounesCoin.text="成功领取"+e+"金币",n.tMove2D(this.bounesCoin,this.bounesCoin.x,this.bounesCoin.y-100,2e3,()=>{this.bounesCoin.visible=!1}),r.changeCoin(e)}}onClosed(){Laya.timer.clearAll(this),this.closeCallbackFun&&this.closeCallbackFun()}_init(){this.closeBtn.on(Laya.Event.CLICK,this,this.closeCB),this.initList()}initList(){this.navData=[].concat(i.instance.navDataArr),this.navList.vScrollBarSkin="",this.navList.repeatX=1,this.navList.repeatY=this.navData.length,this.navList.array=this.navData,this.navList.height=1130*Laya.stage.displayHeight/1334,this.navList.renderHandler=Laya.Handler.create(this,this.onListRender,null,!1),this.navList.mouseHandler=new Laya.Handler(this,this.mouseHandler),Laya.timer.once(1e3,this,()=>{Laya.timer.frameLoop(1,this,this.scrollLoop)})}mouseHandler(e,t){this.againScroll()}againScroll(){Laya.timer.clear(this,this.scrollLoop),Laya.timer.once(1e3,this,()=>{Laya.timer.frameLoop(1,this,this.scrollLoop)})}scrollLoop(){let e=this.navList.scrollBar;e.value+=this.scrollDir,(e.value>=e.max||e.value<=0)&&(this.scrollDir=-this.scrollDir,this.againScroll())}onListRender(e,t){if(!(t>=this.navList.array.length)){var a=e.getChildByName("item"),n=a.getChildByName("icon"),s=a.getChildByName("name");a.getChildByName("star").visible=t<10&&-1!=this.starArr.indexOf(t),n.skin=this.navData[t].icon,s.text=i.instance.getTitle(t),a.off(Laya.Event.CLICK,this,this.navCB,[t]),a.on(Laya.Event.CLICK,this,this.navCB,[t])}}navCB(e){console.log("click id:",e),i.instance.NavigateApp(e,null,null,t.SCENE_PROGRAMUI)}closeCB(){this.close()}}class x extends Laya.Scene{constructor(){super(),this.backBtn=this.backBtn,this.navList=this.navList,this.continueBtn=this.continueBtn,this.navData=[],this.scrollDir=1,this.preIndex=-1,this.closeCallbackFun=null}onOpened(e){e&&e.closeCallbackFun&&(this.closeCallbackFun=e.closeCallbackFun),this._init(),h.instance.hideBanner(),Laya.timer.frameLoop(1,this,()=>{h.instance.hideBanner(!1)})}onClosed(){Laya.timer.clearAll(this),this.closeCallbackFun&&this.closeCallbackFun()}continueBtnCB(){i.instance.NavigateApp(Math.floor(6*Math.random()),null,null,t.SCENE_RECOMMENDUI)}_init(){this.backBtn.on(Laya.Event.CLICK,this,this.closeCB),this.continueBtn.on(Laya.Event.CLICK,this,this.continueBtnCB),this.initList()}initList(){this.navData=[].concat(i.instance.navDataArr),this.navList.vScrollBarSkin="",this.navList.repeatX=2,this.navList.repeatY=Math.floor(this.navData.length/2),this.navList.array=this.navData,this.navList.height=1150*Laya.stage.displayHeight/1334,this.navList.renderHandler=Laya.Handler.create(this,this.onListRender,null,!1),this.navList.mouseHandler=new Laya.Handler(this,this.mouseHandler),Laya.timer.once(1e3,this,()=>{Laya.timer.frameLoop(1,this,this.scrollLoop)})}mouseHandler(e,t){this.againScroll()}againScroll(){Laya.timer.clear(this,this.scrollLoop),Laya.timer.once(1e3,this,()=>{Laya.timer.frameLoop(1,this,this.scrollLoop)})}scrollLoop(){let e=this.navList.scrollBar;e.value+=this.scrollDir,(e.value>=e.max||e.value<=0)&&(this.scrollDir=-this.scrollDir,this.againScroll())}onListRender(e,t){if(!(t>=this.navList.array.length)){var a=e.getChildByName("item"),n=a.getChildByName("icon"),s=a.getChildByName("name");n.skin=this.navData[t].icon,s.text=i.instance.getTitle(t),a.off(Laya.Event.CLICK,this,this.navCB,[t]),a.on(Laya.Event.CLICK,this,this.navCB,[t])}}navCB(e){console.log("click id:",e),i.instance.NavigateApp(e,()=>{i.instance.openScene(t.SCENE_PROGRAMUI)},null,t.SCENE_RECOMMENDUI)}closeCB(){this.close()}}class A extends Laya.Scene{constructor(){super(),this.navList=this.navList,this.navData=[],this.scrollDir=1,this.preIndex=-1}onOpened(t){t&&(t.posY&&(this.navList.y=t.posY),1==t.fixY&&e.fixNodeY(this.navList)),this.initList()}onClosed(){Laya.timer.clearAll(this)}initList(){this.navData=[].concat(i.instance.navDataArr),this.navList.hScrollBarSkin="",this.navList.repeatX=this.navData.length,this.navList.repeatY=1,this.navList.array=this.navData,this.navList.renderHandler=Laya.Handler.create(this,this.onListRender,null,!1),this.navList.mouseHandler=new Laya.Handler(this,this.mouseHandler),this.scrollLoop()}mouseHandler(e,t){Laya.timer.clear(this,this.scrollLoop),Laya.timer.once(1e3,this,this.scrollLoop)}scrollLoop(){Laya.timer.once(1e3,this,()=>{let e=Math.floor(this.navList.startIndex);1==this.scrollDir?++e>=this.navData.length-4&&(e--,this.scrollDir=-this.scrollDir):--e<0&&(this.scrollDir=-this.scrollDir),this.navList.tweenTo(e,1e3,Laya.Handler.create(this,this.scrollLoop))})}onListRender(e,t){if(!(t>=this.navList.array.length)){var a=e.getChildByName("item");a.getChildByName("icon").skin=this.navData[t].icon,a.off(Laya.Event.CLICK,this,this.navCB,[t]),a.on(Laya.Event.CLICK,this,this.navCB,[t])}}navCB(e){console.log("click id:",e),i.instance.NavigateApp(e,()=>{i.instance.openScene(t.SCENE_FULLGAMEUI)},null,t.SCENE_SCROLLUI)}}class U extends Laya.Scene{constructor(){super(),this.backBtn=this.backBtn,this.coinNum=this.coinNum,this.skinIcon=this.skinIcon,this.boxNode=this.boxNode,this.keyNode=this.keyNode,this.videoBtn=this.videoBtn,this.keyNum=3,this.clickCount=0,this.skinId=-1,this.skinIndex=-1,this.gotBounes=!1}onOpened(e){this.backBtn.on(Laya.Event.CLICK,this,this.backBtnCB),this.videoBtn.on(Laya.Event.CLICK,this,this.videoBtnCB),this.initKey(),this.initCoin(),this.getBoxSkinId();for(let e=0;e<this.boxNode.numChildren;e++){let t=this.boxNode.getChildAt(e);t.on(Laya.Event.CLICK,this,this.itemCB,[e]),t.getChildByName("coinNode").visible=!1}}onClosed(){}getBoxSkinId(){let e=r.getBoxSkins();if(e.length<=0)return this.skinId=-1,void(this.skinIcon.skin="mainUI/sy-jb.png");this.skinIndex=Math.floor(Math.random()*e.length),this.skinId=e[this.skinIndex],-1==this.skinId?this.skinIcon.skin="mainUI/sy-jb.png":this.skinIcon.skin=r.getHeroSkinDir(this.skinId)}initKey(){for(let e=0;e<3;e++){this.keyNode.getChildAt(e).skin=e<this.keyNum?"boxUI/bx-ys1.png":"boxUI/bx-ys2.png"}}initCoin(){this.coinNum.value=r.getPlayerData().coin.toString()}itemCB(e){let t=this.boxNode.getChildAt(e),a=t.getChildByName("box"),i=t.getChildByName("coinNode"),n=i.getChildByName("coinNum");if("boxUI/bx-di2.png"==t.skin||this.keyNum<=0)return;t.skin="boxUI/bx-di2.png",this.keyNum--,this.clickCount++,this.initKey(),this.clickCount>=9?(this.keyNode.visible=!1,this.videoBtn.visible=!1):this.keyNum<=0&&(this.keyNode.visible=!1,this.videoBtn.visible=!0);let s=!1,l=5,h=100*Math.random();h<=20||(h<=35?l=10:h<=45?l=15:h<=55?l=20:h<=65?l=25:h<=75?l=30:h<=85?l=35:h<=95?l=50:-1==this.skinId||this.gotBounes?(s=!1,l=50):(this.gotBounes=!0,s=!0)),this.clickCount>=9&&-1!=this.skinId&&!this.gotBounes&&(this.gotBounes=!0,s=!0),s?(r.getPlayerSkin(r.skinArr3.indexOf(this.skinId)+18,this.skinId),a.visible=!0,a.skin=r.getHeroSkinDir(this.skinId),a.y=65):(o.instance.playSoundEffect("getCoin.mp3"),r.changeCoin(l),this.initCoin(),a.visible=!1,i.visible=!0,n.value=l.toString())}videoBtnCB(){c.aldEvent("增加三个钥匙：点击");l.instance.shareGame(()=>{c.aldEvent("增加三个钥匙：成功"),this.keyNum=3,this.videoBtn.visible=!1,this.keyNode.visible=!0,this.initKey()})}backBtnCB(){Laya.Scene.open("MyScenes/GameUI.scene",!0,()=>{w.Share.restartGame()})}}class M extends Laya.Script{constructor(){super(),this.shareIconStr="",this.videoIconStr="",this.myOwner=null}onAwake(){this.myOwner=this.owner}onDisable(){}onUpdate(){c.front_share_number>0?this.myOwner.skin=this.shareIconStr:this.myOwner.skin=this.videoIconStr}}class O extends Laya.Scene{constructor(){super(),this.openBoxBtn=this.openBoxBtn,this.videoBtn=this.videoBtn,this.noBtn=this.noBtn,this.bounes=this.bounes,this.boxBtnEnabled=!0}onOpened(e){h.instance.hideBanner(),c.aldEvent("第"+r.getPlayerData().grade+"关：通关"),this.initData(),i.instance.openScene(t.SCENE_FINISHGAMEUI,!1,{posY:600,fixY:!0}),i.instance.closeScene(t.SCENE_DRAWUI)}onClosed(){h.instance.hideBanner()}initData(){this.openBoxBtn.on(Laya.Event.CLICK,this,this.openBoxCB),this.videoBtn.on(Laya.Event.CLICK,this,this.videoBtnCB),this.noBtn.on(Laya.Event.CLICK,this,this.noBtnCB);let e=r.getPlayerData().grade-1,t=0==Math.floor(e%4)?4:Math.floor(e%4);this.bounes.skin=4==t?"finishUI/js-bx.png":"finishUI/js-ys.png",this.openBoxBtn.visible=4==t,this.videoBtn.visible=4!=t,this.noBtn.visible=4!=t,this.noBtn.visible?c.fixBtnTouchPos(this.noBtn,300,100,this):(this.boxBtnEnabled=!1,c.fixBtnTouchPos(this.openBoxBtn,300,0,this,()=>{this.boxBtnEnabled=!0})),w.Share.isHelpStart=!1,w.Share.gradeIndex=0,r.getPlayerData().gradeIndex=0,r.setPlayerData()}openBoxCB(){this.boxBtnEnabled&&Laya.Scene.open("MyScenes/BoxUI.scene")}videoBtnCB(){c.aldEvent("视频/分享打开宝箱：点击");l.instance.shareGame(()=>{c.aldEvent("视频/分享打开宝箱：成功"),Laya.Scene.open("MyScenes/BoxUI.scene")})}noBtnCB(){this.close(),i.instance.closeScene(t.SCENE_FINISHGAMEUI),i.instance.openScene(t.SCENE_FULLGAMEUI,!1,{grade:r.getPlayerData().grade,continueCallbackFun:()=>{Laya.Scene.open("MyScenes/GameUI.scene",!1,()=>{w.Share.restartGame(),i.instance.openScene(t.SCENE_NEWGAMEUI,!1)})}})}}class H extends Laya.Scene{constructor(){super(),this.closeBtn=this.closeBtn,this.itemNode=this.itemNode,this.randBtn=this.randBtn,this.skinArr=[]}onOpened(e){this.closeBtn.on(Laya.Event.CLICK,this,this.closeBtnCB),this.randBtn.on(Laya.Event.CLICK,this,this.randBtnCB),this.skinArr=r.getFreeSkins(),this.initData(),c.fixBtnTouchPos(this.closeBtn,700,540,this)}onClosed(){h.instance.hideBanner(),h.instance.showBanner()}initData(){for(let e=0;e<4;e++){let t=this.itemNode.getChildAt(e);if(e>=this.skinArr.length){t.visible=!1;continue}t.getChildByName("icon").skin="freeSkins/HeroD_"+(this.skinArr[e]+1)+".png";let a=this.skinArr[e];t.off(Laya.Event.CLICK,this,this.itemCB),t.on(Laya.Event.CLICK,this,this.itemCB,[a])}}itemCB(e){c.aldEvent("试用皮肤：点击");l.instance.shareGame(()=>{c.aldEvent("试用皮肤：成功"),r.freeSkinId=e,w.Share.changePlayerSkin(e),this.closeBtnCB()})}randBtnCB(){let e=n.getRandomItemInArr(this.skinArr);this.itemCB(e)}closeBtnCB(){this.close(),w.Share.canReady=!0,w.Share.readyGo()}}class G extends Laya.Scene{constructor(){super(),this.closeBtn=this.closeBtn,this.barNode=this.barNode,this.clickBtn=this.clickBtn,this.atkAni=this.atkAni,this.curProgress=0,this.closeCallback=null,this.hadShowBanner=!1}onOpened(e){null!=e&&null!=e&&(this.closeCallback=e),this.atkAni.loop=!1,this.closeBtn.on(Laya.Event.CLICK,this,this.closeBtnCB),this.clickBtn.on(Laya.Event.MOUSE_DOWN,this,this.clickBtnCBDown),this.clickBtn.on(Laya.Event.MOUSE_UP,this,this.clickBtnCBUp),i.instance.dataConfig.front_box_button?n.visibleDelay(this.closeBtn,3e3):this.closeBtn.visible=!1,Laya.timer.frameLoop(1,this,this.decBar),c.isKillBossUI=!0,c.WxOnHide(()=>{c.isKillBossUI&&Laya.timer.once(100,this,()=>{Laya.Scene.close("MyScenes/KillBossUI.scene")})}),h.instance.hideBanner(),Laya.timer.once(5e3,this,()=>{this.close()}),c.aldEvent("狂点宝箱界面显示")}onClosed(){h.instance.hideBanner(),Laya.timer.clearAll(this),this.closeCallback&&this.closeCallback(),c.isKillBossUI=!1}decBar(){this.curProgress>=1?Laya.timer.clear(this,this.decBar):(this.curProgress-=.005,this.curProgress<0&&(this.curProgress=0),this.barNode.value=this.curProgress)}clickBtnCBDown(){w.Share.gotKillBossBounes=!0;let e=c.tempGrade,t=(e-i.instance.dataConfig.front_box_gate)%i.instance.dataConfig.front_box_everygate==0&&e-i.instance.dataConfig.front_box_gate>=0;if(!this.hadShowBanner&&e>=i.instance.dataConfig.front_box_gate&&t&&c.isValidBanner()&&(c.aldEvent("狂点宝箱界面点击触发按钮"),this.hadShowBanner=!0,Laya.timer.once(1e3,this,()=>{h.instance.showBanner()})),this.atkAni.play(0,!1),this.clickBtn.scaleX=1.2,this.clickBtn.scaleY=1.2,this.curProgress+=.15,this.curProgress>1)return this.curProgress=1,this.barNode.value=1,void this.close();this.createCoin(),this.createCoin(),this.createCoin(),this.createCoin(),this.createCoin()}clickBtnCBUp(){this.clickBtn.scaleX=1,this.clickBtn.scaleY=1}closeBtnCB(){c.aldEvent("主动点击关闭狂点宝箱界面"),this.close()}createCoin(){let e=g.instance().getItem(a.Coin);this.addChild(e),e.pos(375,500);let t=new Laya.Vector2(400*Math.random()-200,400*Math.random()-200);Laya.Tween.to(e,{x:t.x+375,y:t.y+500},200),Laya.timer.once(1e3,this,()=>{e.destroy()})}}class R extends Laya.Scene{constructor(){super(),this.perNum=this.perNum,this.bar=this.bar}onOpened(e){o.instance.initLoading(()=>{Laya.Browser.onWeiXin?this.loadSubpackage():this.loadRes()}),c.aldEvent("加载页面")}onClosed(){}loadSubpackage(){Laya.Browser.window.wx.loadSubpackage({name:"unity",success:e=>{this.loadRes()},fail:e=>{this.loadSubpackage()}}).onProgressUpdate(e=>{console.log("下载进度",e.progress),console.log("已经下载的数据长度",e.totalBytesWritten),console.log("预期需要下载的数据总长度",e.totalBytesExpectedToWrite),this.perNum.text=Math.floor(e.progress/2)+"%",this.bar.width=e.progress/50*560})}loadRes(){var e=[c.UnityPath+"line.lh",c.UnityPath+"Hero_1.lh",c.UnityPath+"Hero_Boss.lh",c.UnityPath+"Circle_1.lh",c.UnityPath+"hitFX.lh"];for(let t=0;t<7;t++)e.push(c.UnityPath+"Arms_"+(t+1)+".lh");for(let t=0;t<10;t++)e.push(c.UnityPath+"Hero"+(t+1)+"_Emb.lh");Laya.loader.create(e,Laya.Handler.create(this,this.onComplete),Laya.Handler.create(this,this.onProgress))}onComplete(){w.Share.initScene(),Laya.timer.once(1e3,this,()=>{Laya.Scene.open("MyScenes/GameUI.scene",!0,()=>{w.Share.createPlayer(),w.Share.createAi()}),c.aldEvent("进入首页")})}onProgress(e){this.perNum.text=50+Math.floor(50*e)+"%",this.bar.width=280+560*e/2}}class V extends Laya.Scene{constructor(){super(),this.coinNum=this.coinNum,this.noBtn=this.noBtn,this.trippleBtn=this.trippleBtn,this.toggleBtn=this.toggleBtn,this.point=this.point,this.exTimeMin=0,this.bounesNum=0,this.bounesNumTriple=0,this.isTripple=!0,this.updateCompleted=!0}onOpened(e){this.toggleBtn.on(Laya.Event.CLICK,this,this.trippleBtnCB),this.trippleBtn.on(Laya.Event.CLICK,this,this.getBounesCB),this.noBtn.on(Laya.Event.CLICK,this,this.getBounesCB),this.exTimeMin=e,this.bounesNum=r.getPlayerOffline(this.exTimeMin),this.bounesNumTriple=3*this.bounesNum,this.initData(),h.instance.showBanner()}onClosed(){h.instance.hideBanner(),c.hadShowFriendUI||(c.hadShowFriendUI=!0,i.instance.openScene(t.SCENE_FRIENDGAME,!1,{closeCallbackFun:()=>{i.instance.dataConfig.front_index_video?h.instance.showVideo(()=>{}):i.instance.openScene(t.SCENE_RECOMMENDUI,!1)}}))}initData(){this.coinNum.value=this.bounesNumTriple.toString(),this.changePoint(),this.changeBtn()}trippleBtnCB(){this.updateCompleted&&(this.updateCompleted=!1,this.isTripple=!this.isTripple,this.changePoint(),this.changeBtn(),n.updateNumber(this.bounesNum,3,this.coinNum,!1,this.isTripple,()=>{this.updateCompleted=!0}))}getBounesCB(){let e=()=>{this.isTripple&&c.aldEvent("离线收益三倍：成功"),r.changeCoin(this.isTripple?this.bounesNumTriple:this.bounesNum),p.Share.initData(),this.close()};this.isTripple?(c.aldEvent("离线收益三倍：点击"),l.instance.shareGame(e)):e()}changePoint(){this.point.skin=this.isTripple?"offlineUI/lx-yuan.png":"offlineUI/lx-yuan2.png"}changeBtn(){this.noBtn.visible=!this.isTripple,this.trippleBtn.visible=this.isTripple}}class T extends Laya.Script{constructor(){super(),this.myOwner=null,this._ani=null,this.weaponNode=null,this.embNode=null,this.embScale=null,this.embPos=null,this.embRotation=null}onAwake(){this.myOwner=this.owner,this._ani=this.owner.getComponent(Laya.Animator),this.playIdle1(),this.weaponNode=n.findNodeByName(this.myOwner,"Dummy_Arms"),this.embNode=n.findNodeByName(this.myOwner,"Dummy_Emb");let e=n.findNodeByName(this.myOwner,"Hero1_Emb");this.embScale=e.transform.localScale.clone(),this.embPos=e.transform.localPosition.clone(),this.embRotation=e.transform.localRotation.clone(),this.changeSkin(r.getPlayerData().playerId)}onDisable(){}playIdle1(){this._ani.crossFade("walk",.05),this._ani.crossFade("hit",.05,1)}changeSkin(e){let t=new Laya.UnlitMaterial;Laya.Texture2D.load("res/skinHero/HeroD_"+(e+1)+".png",Laya.Handler.create(this,function(e){t.albedoTexture=e}));for(let e=1;e<=4;e++){this.owner.getChildAt(e).skinnedMeshRenderer.material=t}this.embNode.destroyChildren();let a=Laya.loader.getRes(c.UnityPath+"Hero"+(e+1)+"_Emb.lh"),i=Laya.Sprite3D.instantiate(a,this.embNode,!1,new Laya.Vector3(0,0,0));i.transform.localScale=this.embScale,i.transform.localPosition=this.embPos,i.transform.localRotation=this.embRotation}}class F extends Laya.Scene{constructor(){super(),this.topBar=this.topBar,this.backBtn=this.backBtn,this.coinNum=this.coinNum,this.typePic=this.typePic,this.itemNode=this.itemNode,this.leftBtn=this.leftBtn,this.rightBtn=this.rightBtn,this.pointNode=this.pointNode,this.btn1=this.btn1,this.btn2=this.btn2,this.btn3=this.btn3,this.pageIndex=0,this.scene3D=null,this.light=null,this.camera=null,this.role=null,this.roleCrl=null}onOpened(e){this.backBtn.on(Laya.Event.CLICK,this,this.backBtnCB),this.leftBtn.on(Laya.Event.CLICK,this,this.turnPageCB,[!0]),this.rightBtn.on(Laya.Event.CLICK,this,this.turnPageCB,[!1]),this.leftBtn.visible=!1,this.btn1.on(Laya.Event.CLICK,this,this.btnCB1),this.btn2.on(Laya.Event.CLICK,this,this.btnCB2),this.updateCoinNum(),this.initData(),this.init3DScene()}onClosed(){r.getPlayerData().grade>=i.instance.dataConfig.front_auto_history_level&&i.instance.openScene(t.SCENE_PROGRAMUI,!1)}init3DScene(){this.scene3D=Laya.stage.addChild(new Laya.Scene3D),this.light=this.scene3D.addChild(new Laya.DirectionLight),this.light.color=new Laya.Vector3(1,.956,.839),this.light.transform.rotate(new Laya.Vector3(59.3,-55.16,0),!0,!1),this.camera=this.scene3D.addChild(new Laya.Camera(0,.1,100)),this.camera.transform.translate(new Laya.Vector3(0,2,7)),this.camera.transform.rotate(new Laya.Vector3(-10,0,0),!0,!1),this.camera.clearFlag=Laya.BaseCamera.CLEARFLAG_DEPTHONLY,this.fixCameraField();let e=Laya.loader.getRes(c.UnityPath+"Hero_1.lh");this.role=Laya.Sprite3D.instantiate(e,this.scene3D,!1,new Laya.Vector3(0,0,0)),this.role.transform.position=new Laya.Vector3(0,2.6,0),this.role.transform.rotationEuler=new Laya.Vector3(0,0,0),this.role.transform.setWorldLossyScale(new Laya.Vector3(.5,.5,.5)),this.roleCrl=this.role.addComponent(T)}fixCameraField(){let e=(Laya.stage.displayHeight-1334<0?0:Laya.stage.displayHeight-1334)/290*10;this.camera.fieldOfView+=e}initData(){this.typePic.skin="skinUI/pf-an"+(this.pageIndex+1)+".png";for(let e=0;e<this.pointNode.numChildren;e++){this.pointNode.getChildAt(e).skin=e==this.pageIndex?"skinUI/pf-yuan2.png":"skinUI/pf-yuan1.png"}this.btn1.getChildAt(0).text=r.getUnlockSkinCost().toString(),this.btn1.visible=0==this.pageIndex,this.btn2.visible=1==this.pageIndex,this.btn3.visible=2==this.pageIndex,this.initItem()}initItem(){for(let e=0;e<this.itemNode.numChildren;e++){let t=this.itemNode.getChildAt(e),a=t.getChildByName("icon"),i=t.getChildByName("tick");t.off(Laya.Event.CLICK,this,this.itemCB);let n=e+9*this.pageIndex,s=r.getPlayerData().playerArr[n]>=0,o=r.skinArr1;switch(this.pageIndex){case 0:o=r.skinArr1;break;case 1:o=r.skinArr2;break;case 2:o=r.skinArr3}e+1<=o.length?(a.visible=s,t.skin=s?"skinUI/pf-di2.png":"skinUI/pf-di.png",s&&(a.skin="heroSkins/Hero_"+(o[e]+1)+".png",t.on(Laya.Event.CLICK,this,this.itemCB,[n])),i.visible=s&&r.getPlayerData().playerId==o[e]):(i.visible=!1,a.visible=!1,t.skin="skinUI/pf-di.png")}}itemCB(e){r.getPlayerData().playerId=r.getPlayerData().playerArr[e],this.roleCrl.changeSkin(r.getPlayerData().playerId),w.Share.changePlayerSkin(),this.initData()}updateCoinNum(){this.coinNum.value=r.getPlayerData().coin.toString(),p.Share.initData()}turnPageCB(e){e?this.pageIndex--:this.pageIndex++,this.leftBtn.visible=this.pageIndex>0,this.rightBtn.visible=this.pageIndex<2,this.initData()}btnCB1(){let e=[].concat(r.getCoinSkins());if(e.length<=0)return void c.OpenAlert("敬请期待！");c.aldEvent("皮肤界面：金币解锁");let t=r.getUnlockSkinCost();if(t>r.getPlayerData().coin)return void c.OpenAlert("金币不足！");c.aldEvent("皮肤界面：金币解锁成功"),r.getPlayerData().unlockSkinCount++,r.changeCoin(-t),this.updateCoinNum();let a=n.getRandomItemInArr(e),i=r.skinArr1.indexOf(a);r.getPlayerSkin(i,a),this.roleCrl.changeSkin(r.getPlayerData().playerId),w.Share.changePlayerSkin(),this.initData()}btnCB2(){let e=[].concat(r.getVideoSkins());if(console.log(e),e.length<=0)return void c.OpenAlert("敬请期待！");c.aldEvent("皮肤界面：视频/分享解锁");l.instance.shareGame(()=>{c.aldEvent("皮肤界面：视频/分享解锁成功");let t=n.getRandomItemInArr(e),a=r.skinArr2.indexOf(t)+9;r.getPlayerSkin(a,t),this.roleCrl.changeSkin(r.getPlayerData().playerId),w.Share.changePlayerSkin(),this.initData()})}backBtnCB(){this.scene3D.destroy(),this.close()}}class K{constructor(){}static init(){var e=Laya.ClassUtils.regClass;e("JJExport/View/DrawUI.ts",B),e("JJExport/Libs/AutoFixPosY.ts",I),e("JJExport/View/FinishGameUI.ts",N),e("JJExport/View/FriendGameUI.ts",D),e("JJExport/View/FullGameUI.ts",E),e("Libs/FixNodeY.ts",k),e("JJExport/View/NewGameUI.ts",_),e("JJExport/View/ProgramUI.ts",P),e("JJExport/View/RecommendUI.ts",x),e("JJExport/View/ScrollUI.ts",A),e("View/BoxUI.ts",U),e("Libs/FixAdShareIcon.ts",M),e("View/FinishUI.ts",O),e("View/FreeSkinUI.ts",H),e("View/GameUI.ts",m),e("View/GameTopNode.ts",p),e("View/KillBossUI.ts",G),e("View/LoadingUI.ts",R),e("View/OfflineUI.ts",V),e("View/SkinUI.ts",F),e("Crl/FixAiTips.ts",u)}}K.width=750,K.height=1334,K.scaleMode="fixedwidth",K.screenMode="vertical",K.alignV="middle",K.alignH="center",K.startScene="MyScenes/LoadingUI.scene",K.sceneRoot="",K.debug=!1,K.stat=!1,K.physicsDebug=!1,K.exportSceneToJson=!0,K.init();new class{constructor(){window.Laya3D?Laya3D.init(K.width,K.height):Laya.init(K.width,K.height,Laya.WebGL),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=K.scaleMode,Laya.stage.screenMode=K.screenMode,Laya.stage.alignV=K.alignV,Laya.stage.alignH=K.alignH,Laya.URL.exportSceneToJson=K.exportSceneToJson,(K.debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),K.physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),K.stat&&Laya.Stat.show(),Laya.alertGlobalError(!0),Laya.ResourceVersion.enable("version.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION)}onVersionLoaded(){Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onConfigLoaded))}onConfigLoaded(){new w}}}();